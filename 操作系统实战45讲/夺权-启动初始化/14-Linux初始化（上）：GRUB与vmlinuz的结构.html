<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>-->
    <title>14-Linuxåˆå§‹åŒ–ï¼ˆä¸Šï¼‰ï¼šGRUBä¸vmlinuzçš„ç»“æ„</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>14-Linuxåˆå§‹åŒ–ï¼ˆä¸Šï¼‰ï¼šGRUBä¸vmlinuzçš„ç»“æ„</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚</p><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å»ºå¥½äº†äºŒçº§å¼•å¯¼å™¨ï¼Œå¯åŠ¨äº†æˆ‘ä»¬çš„Cosmosï¼Œå¹¶è¿›è¡Œäº†æˆ‘ä»¬Cosmosçš„Halå±‚åˆå§‹åŒ–ã€‚</p><p>æˆ‘ä¼šç”¨ä¸¤èŠ‚è¯¾å¸¦ä½ é¢†ä¼šLinuxæ€æ ·åšåˆå§‹åŒ–ã€‚è™½ç„¶æˆ‘ä»¬è‡ªå·±å…·ä½“å®ç°è¿‡äº†åˆå§‹åŒ–ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿä¸å¦¨çœ‹çœ‹Linuxçš„åˆå§‹åŒ–æµç¨‹ï¼Œå€Ÿé‰´ä¸€ä¸‹Linuxå¼€å‘è€…çš„ç©æ³•ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šå…ˆä¸ºä½ æ¢³ç†å¯åŠ¨çš„æ•´ä½“æµç¨‹ï¼Œé‡ç‚¹ä¸ºä½ è§£è¯»Linuxä¸ŠGRUBæ˜¯æ€æ ·å¯åŠ¨ï¼Œä»¥åŠå†…æ ¸é‡Œçš„â€œå®æƒäººç‰©â€â€”â€”vmlinuzå†…æ ¸æ–‡ä»¶æ˜¯å¦‚ä½•äº§ç”Ÿå’Œè¿è½¬çš„ã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»setup.binæ–‡ä»¶çš„_startå‡½æ•°å…¥æ‰‹ï¼Œç ”ç©¶Linuxåˆå§‹åŒ–æµç¨‹ã€‚</p><p>å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»å…¨å±€æµç¨‹è®²èµ·ï¼Œæ­£å¼è¿›å…¥ä»Šå¤©çš„å­¦ä¹ ã€‚</p><h2>å…¨å±€æµç¨‹</h2><p>x86å¹³å°çš„å¯åŠ¨æµç¨‹ï¼Œæ˜¯éå¸¸å¤æ‚çš„ã€‚ä¸ºäº†å¸®åŠ©ä½ ç†è§£ï¼Œæˆ‘ä»¬å…ˆä»å…¨å±€ç²—ç•¥åœ°çœ‹ä¸€çœ‹æ•´ä½“æµç¨‹ï¼Œç„¶åä¸€æ­¥æ­¥ç»†åŒ–ã€‚</p><p>åœ¨æœºå™¨åŠ ç”µåï¼ŒBIOSä¼šè¿›è¡Œè‡ªæ£€ï¼Œç„¶åç”±BIOSåŠ è½½å¼•å¯¼è®¾å¤‡ä¸­å¼•å¯¼æ‰‡åŒºã€‚åœ¨å®‰è£…æœ‰Linuxæ“ä½œç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œåœ¨å¼•å¯¼æ‰‡åŒºé‡Œï¼Œé€šå¸¸æ˜¯å®‰è£…çš„GRUBçš„ä¸€å°æ®µç¨‹åºï¼ˆå®‰è£…windowsçš„æƒ…å†µåˆ™ä¸åŒï¼‰ã€‚æœ€åï¼ŒGRUBä¼šåŠ è½½Linuxçš„å†…æ ¸æ˜ åƒvmlinuzï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/f3/b3/f3d8b95e8c1563466d31f385bb42aab3.jpg" alt="" title="x86çš„å…¨å±€å¯åŠ¨æµç¨‹ç¤ºæ„å›¾"></p><p>ä¸Šå›¾ä¸­çš„å¼•å¯¼è®¾å¤‡é€šå¸¸æ˜¯æœºå™¨ä¸­çš„ç¡¬ç›˜ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯Uç›˜æˆ–è€…å…‰ç›˜ç”šè‡³æ˜¯è½¯ç›˜ã€‚BIOSä¼šè‡ªåŠ¨è¯»å–ä¿å­˜åœ¨CMOSä¸­çš„å¼•å¯¼è®¾å¤‡ä¿¡æ¯ã€‚</p><!-- [[[read_end]]] --><h2>ä»BIOSåˆ°GRUB</h2><p>ä»å‰é¢çš„è¯¾ç¨‹æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒCPUè¢«è®¾è®¡æˆåªèƒ½è¿è¡Œå†…å­˜ä¸­çš„ç¨‹åºï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥è¿è¡Œå‚¨å­˜åœ¨ç¡¬ç›˜æˆ–è€…Uç›˜ä¸­çš„æ“ä½œç³»ç»Ÿç¨‹åºã€‚</p><p>å¦‚æœæƒ³è¦è¿è¡Œç¡¬ç›˜æˆ–è€…Uç›˜ä¸­çš„ç¨‹åºï¼Œå°±å¿…é¡»è¦å…ˆåŠ è½½åˆ°å†…å­˜ï¼ˆRAMï¼‰ä¸­æ‰èƒ½è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºç¡¬ç›˜ã€Uç›˜ï¼ˆå¤–éƒ¨å‚¨å­˜å™¨ï¼‰å¹¶ä¸å’ŒCPUç›´æ¥ç›¸è¿ï¼Œå®ƒä»¬çš„è®¿é—®æœºåˆ¶å’Œå¯»å€æ–¹å¼ä¸å†…å­˜æˆªç„¶ä¸åŒã€‚</p><p>å†…å­˜åœ¨æ–­ç”µåå°±æ²¡æ³•ä¿å­˜æ•°æ®äº†ï¼Œé‚£BIOSåˆæ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢ï¼Ÿç¡¬ä»¶å·¥ç¨‹å¸ˆè®¾è®¡CPUæ—¶ï¼Œç¡¬æ€§åœ°è§„å®šåœ¨åŠ ç”µçš„ç¬é—´ï¼Œå¼ºåˆ¶å°†CSå¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º0XF000ï¼ŒIPå¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º0XFFF0ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼ŒCS:IPå°±æŒ‡å‘äº†0XFFFF0è¿™ä¸ªç‰©ç†åœ°å€ã€‚åœ¨è¿™ä¸ªç‰©ç†åœ°å€ä¸Šè¿æ¥äº†ä¸»æ¿ä¸Šçš„ä¸€å—å°çš„ROMèŠ¯ç‰‡ã€‚è¿™ç§èŠ¯ç‰‡çš„è®¿é—®æœºåˆ¶å’Œå¯»å€æ–¹å¼å’Œå†…å­˜ä¸€æ ·ï¼Œåªæ˜¯å®ƒåœ¨æ–­ç”µæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œåœ¨å¸¸è§„ä¸‹ä¹Ÿä¸èƒ½å¾€è¿™é‡Œå†™å…¥æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åªè¯»å†…å­˜</strong>ï¼ŒBIOSç¨‹åºå°±è¢«å›ºåŒ–åœ¨è¯¥ROMèŠ¯ç‰‡é‡Œã€‚</p><p>ç°åœ¨ï¼ŒCS:IPæŒ‡å‘äº†0XFFFF0è¿™ä¸ªä½ç½®ï¼Œæ­£æ˜¯BIOSç¨‹åºçš„å…¥å£åœ°å€ã€‚è¿™æ„å‘³ç€BIOSæ­£å¼å¼€å§‹å¯åŠ¨ã€‚</p><p>BIOSä¸€å¼€å§‹ä¼šåˆå§‹åŒ–CPUï¼Œæ¥ç€æ£€æŸ¥å¹¶åˆå§‹åŒ–å†…å­˜ï¼Œç„¶åå°†è‡ªå·±çš„ä¸€éƒ¨åˆ†å¤åˆ¶åˆ°å†…å­˜ï¼Œæœ€åè·³è½¬åˆ°å†…å­˜ä¸­è¿è¡Œã€‚BIOSçš„ä¸‹ä¸€æ­¥å°±æ˜¯æšä¸¾æœ¬åœ°è®¾å¤‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶è¿›è¡Œç›¸å…³çš„æ£€æŸ¥ï¼Œæ£€æŸ¥ç¡¬ä»¶æ˜¯å¦æŸåï¼Œè¿™æœŸé—´BIOSä¼šè°ƒç”¨å…¶å®ƒè®¾å¤‡ä¸Šçš„å›ºä»¶ç¨‹åºï¼Œå¦‚æ˜¾å¡ã€ç½‘å¡ç­‰è®¾å¤‡ä¸Šçš„å›ºä»¶ç¨‹åºã€‚</p><p>å½“è®¾å¤‡åˆå§‹åŒ–å’Œæ£€æŸ¥æ­¥éª¤å®Œæˆä¹‹åï¼Œ<strong>BIOSä¼šåœ¨å†…å­˜ä¸­å»ºç«‹ä¸­æ–­è¡¨å’Œä¸­æ–­æœåŠ¡ç¨‹åº</strong>ï¼Œè¿™æ˜¯å¯åŠ¨Linuxè‡³å…³é‡è¦çš„å·¥ä½œï¼Œå› ä¸ºLinuxä¼šç”¨åˆ°å®ƒä»¬ã€‚</p><p>å…·ä½“æ˜¯æ€ä¹ˆæ“ä½œçš„å‘¢ï¼ŸBIOSä¼šä»å†…å­˜åœ°å€ï¼ˆ0x00000ï¼‰å¼€å§‹ç”¨1KBçš„å†…å­˜ç©ºé—´ï¼ˆ0x00000~0x003FFï¼‰æ„å»ºä¸­æ–­è¡¨ï¼Œåœ¨ç´§æ¥ç€ä¸­æ–­è¡¨çš„ä½ç½®ï¼Œç”¨256KBçš„å†…å­˜ç©ºé—´æ„å»ºBIOSæ•°æ®åŒºï¼ˆ0x00400~0x004FFï¼‰ï¼Œå¹¶åœ¨0x0e05bçš„åœ°å€åŠ è½½äº†8KBå¤§å°çš„ä¸ä¸­æ–­è¡¨å¯¹åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</p><p>ä¸­æ–­è¡¨ä¸­æœ‰256ä¸ªæ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®å ç”¨4ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ä¸¤ä¸ªå­—èŠ‚æ˜¯CSå¯„å­˜å™¨çš„å€¼ï¼Œä¸¤ä¸ªå­—èŠ‚æ˜¯IPå¯„å­˜å™¨çš„å€¼ã€‚æ¯ä¸ªæ¡ç›®éƒ½æŒ‡å‘ä¸€ä¸ªå…·ä½“çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</p><p>ä¸ºäº†å¯åŠ¨å¤–éƒ¨å‚¨å­˜å™¨ä¸­çš„ç¨‹åºï¼ŒBIOSä¼šæœç´¢å¯å¼•å¯¼çš„è®¾å¤‡ï¼Œæœç´¢çš„é¡ºåºæ˜¯ç”±CMOSä¸­çš„è®¾ç½®ä¿¡æ¯å†³å®šçš„ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶è®²çš„ï¼Œæ‰€è°“çš„åœ¨BIOSä¸­è®¾ç½®çš„å¯åŠ¨è®¾å¤‡é¡ºåºï¼‰ã€‚ä¸€ä¸ªæ˜¯è½¯é©±ï¼Œä¸€ä¸ªæ˜¯å…‰é©±ï¼Œä¸€ä¸ªæ˜¯ç¡¬ç›˜ä¸Šï¼Œè¿˜å¯ä»¥æ˜¯ç½‘ç»œä¸Šçš„è®¾å¤‡ç”šè‡³æ˜¯ä¸€ä¸ªusb æ¥å£çš„Uç›˜ï¼Œéƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯åŠ¨è®¾å¤‡ã€‚</p><p>å½“ç„¶ï¼ŒLinuxé€šå¸¸æ˜¯ä»ç¡¬ç›˜ä¸­å¯åŠ¨çš„ã€‚ç¡¬ç›˜ä¸Šçš„ç¬¬1ä¸ªæ‰‡åŒºï¼ˆæ¯ä¸ªæ‰‡åŒº512å­—èŠ‚ç©ºé—´ï¼‰ï¼Œè¢«ç§°ä¸º<strong>MBRï¼ˆä¸»å¯åŠ¨è®°å½•ï¼‰</strong>ï¼Œå…¶ä¸­åŒ…å«æœ‰åŸºæœ¬çš„GRUBå¯åŠ¨ç¨‹åºå’Œåˆ†åŒºè¡¨ï¼Œå®‰è£…GRUBæ—¶ä¼šè‡ªåŠ¨å†™å…¥åˆ°è¿™ä¸ªæ‰‡åŒºï¼Œå½“MBRè¢«BIOSè£…è½½åˆ°0x7c00åœ°å€å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸­åï¼ŒBIOSå°±ä¼šå°†æ§åˆ¶æƒè½¬äº¤ç»™äº†MBRã€‚åœ¨å½“å‰çš„æƒ…å†µä¸‹ï¼Œå…¶å®æ˜¯äº¤ç»™äº†GRUBã€‚</p><p>åˆ°è¿™é‡Œï¼ŒBIOSåˆ°GRUBçš„è¿‡ç¨‹ç»“æŸã€‚</p><h2>GRUBæ˜¯å¦‚ä½•å¯åŠ¨çš„</h2><p>æ ¹æ®å‰é¢å†…å®¹å¯ä»¥å‘ç°ï¼ŒBIOSåªä¼šåŠ è½½ç¡¬ç›˜ä¸Šçš„ç¬¬1ä¸ªæ‰‡åŒºã€‚ä¸è¿‡è¿™ä¸ªæ‰‡åŒºä»…æœ‰512å­—èŠ‚ï¼Œè¿™512å­—èŠ‚ä¸­è¿˜æœ‰64å­—èŠ‚çš„åˆ†åŒºè¡¨åŠ 2å­—èŠ‚çš„å¯åŠ¨æ ‡å¿—ï¼Œå¾ˆæ˜¾ç„¶ï¼Œå‰©ä¸‹446å­—èŠ‚çš„ç©ºé—´ï¼Œæ˜¯è£…ä¸ä¸‹GRUBè¿™ç§å¤§å‹é€šç”¨å¼•å¯¼å™¨çš„ã€‚</p><p>äºæ˜¯ï¼ŒGRUBçš„åŠ è½½åˆ†æˆäº†å¤šä¸ªæ­¥éª¤ï¼ŒåŒæ—¶GRUBä¹Ÿåˆ†æˆäº†å¤šä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ª<strong>é‡è¦çš„æ–‡ä»¶boot.imgå’Œcore.img</strong>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/b9/85/b92dyy0f686e730ffcb606ed17e5b785.jpg" alt="" title="GRUBæ ¸å¿ƒæ–‡ä»¶"></p><p>å…¶ä¸­ï¼Œboot.imgè¢«GRUBçš„å®‰è£…ç¨‹åºå†™å…¥åˆ°ç¡¬ç›˜çš„MBRä¸­ï¼ŒåŒæ—¶åœ¨boot.imgæ–‡ä»¶ä¸­çš„ä¸€ä¸ªä½ç½®å†™å…¥core.imgæ–‡ä»¶å ç”¨çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„æ‰‡åŒºå·ã€‚</p><p>è€Œcore.imgæ–‡ä»¶æ˜¯ç”±GRUBå®‰è£…ç¨‹åºæ ¹æ®å®‰è£…æ—¶ç¯å¢ƒä¿¡æ¯ï¼Œç”¨å…¶å®ƒGRUBçš„æ¨¡å—æ–‡ä»¶åŠ¨æ€ç”Ÿæˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/cb/4b/cb36d637ce0a0d7c38788102e139604b.jpg" alt="" title="GRUB-coreimgæ ¼å¼"></p><p>å¦‚æœæ˜¯ä»ç¡¬ç›˜å¯åŠ¨çš„è¯ï¼Œcore.imgä¸­çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„å†…å®¹å°±æ˜¯diskboot.imgæ–‡ä»¶ã€‚diskboot.imgæ–‡ä»¶çš„ä½œç”¨æ˜¯ï¼Œ<strong>è¯»å–core.imgä¸­å‰©ä½™çš„éƒ¨åˆ†åˆ°å†…å­˜ä¸­ã€‚</strong></p><p>ç”±äºè¿™æ—¶diskboot.imgæ–‡ä»¶è¿˜ä¸è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å°†core.imgæ–‡ä»¶çš„å…¨éƒ¨ä½ç½®ï¼Œéƒ½ç”¨æ–‡ä»¶å—åˆ—è¡¨çš„æ–¹å¼ä¿å­˜åˆ°diskboot.imgæ–‡ä»¶ä¸­ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿diskboot.imgæ–‡ä»¶æ‰¾åˆ°core.imgæ–‡ä»¶çš„å‰©ä½™å†…å®¹ï¼Œæœ€åå°†æ§åˆ¶æƒäº¤ç»™kernel.imgæ–‡ä»¶ã€‚</p><p>å› ä¸ºè¿™æ—¶core.imgæ–‡ä»¶ä¸­åµŒå…¥äº†è¶³å¤Ÿå¤šçš„åŠŸèƒ½æ¨¡å—ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯GRUBè¯†åˆ«å‡ºç¡¬ç›˜åˆ†åŒºä¸Šæ–‡ä»¶ç³»ç»Ÿï¼Œèƒ½å¤Ÿè®¿é—®/boot/grubç›®å½•ï¼Œå¹¶ä¸”å¯ä»¥åŠ è½½ç›¸å…³çš„é…ç½®æ–‡ä»¶å’ŒåŠŸèƒ½æ¨¡å—ï¼Œæ¥å®ç°ç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åŠ è½½å¯åŠ¨èœå•ã€åŠ è½½ç›®æ ‡æ“ä½œç³»ç»Ÿç­‰ã€‚</p><p>æ­£å› ä¸ºGRUB2å¤§é‡ä½¿ç”¨äº†åŠ¨æ€åŠ è½½åŠŸèƒ½æ¨¡å—ï¼Œè¿™ä½¿å¾—core.imgæ–‡ä»¶çš„ä½“ç§¯å˜å¾—è¶³å¤Ÿå°ã€‚è€ŒGRUBçš„core.imgæ–‡ä»¶ä¸€æ—¦å¼€å§‹å·¥ä½œï¼Œå°±å¯ä»¥åŠ è½½Linuxç³»ç»Ÿçš„vmlinuzå†…æ ¸æ–‡ä»¶äº†ã€‚</p><h2>è¯¦è§£vmlinuzæ–‡ä»¶ç»“æ„</h2><p>æˆ‘ä»¬åœ¨/bootç›®å½•ä¸‹ä¼šå‘ç°vmlinuzæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ</p><p>å…¶å®å®ƒæ˜¯ç”±Linuxç¼–è¯‘ç”Ÿæˆçš„bzImageæ–‡ä»¶å¤åˆ¶è€Œæ¥çš„ï¼Œä½ è‡ªå·±å¯ä»¥ä¸‹è½½æœ€æ–°çš„Linuxä»£ç .</p><p>æˆ‘ä»¬ä¸€è‡´æŠŠLinuxæºç è§£å‹åˆ°ä¸€ä¸ªlinuxç›®å½•ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åé¢æŸ¥æ‰¾Linuxæºä»£ç æ–‡ä»¶æ€»æ˜¯ä»linuxç›®å½•å¼€å§‹çš„ï¼Œåˆ‡æ¢åˆ°ä»£ç ç›®å½•æ‰§è¡Œmake ARCH=x86_64ï¼Œå†æ‰§è¡Œmake installï¼Œå°±ä¼šäº§ç”Ÿvmlinuzæ–‡ä»¶ï¼Œä½ å¯ä»¥å‚è€ƒåé¢çš„makefileä»£ç ã€‚</p><pre><code>#linux/arch/x86/boot/Makefile
install:    sh $(srctree)/$(src)/install.sh $(KERNELRELEASE) $(obj)/bzImage \        System.map &quot;$(INSTALL_PATH)&quot;
</code></pre><p>install.shè„šæœ¬æ–‡ä»¶åªæ˜¯å®Œæˆå¤åˆ¶çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ææ‡‚äº†bzImageæ–‡ä»¶ç»“æ„ï¼Œå°±ç­‰åŒäºç†è§£äº†vmlinuzæ–‡ä»¶ç»“æ„ã€‚</p><p>é‚£ä¹ˆbzImageæ–‡ä»¶åˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬åªè¦ç ”ç©¶bzImageæ–‡ä»¶åœ¨Makefileä¸­çš„ç”Ÿæˆè§„åˆ™ï¼Œå°±ä¼šæç„¶å¤§æ‚Ÿï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><pre><code>#linux/arch/x86/boot/Makefile
$(obj)/bzImage: $(obj)/setup.bin $(obj)/vmlinux.bin $(obj)/tools/build FORCE    $(call if_changed,image)    @$(kecho) 'Kernel: $@ is ready' ' (#'`cat .version`')'
</code></pre><p>ä»å‰é¢çš„ä»£ç å¯ä»¥çŸ¥é“ï¼Œç”ŸæˆbzImageæ–‡ä»¶éœ€è¦ä¸‰ä¸ªä¾èµ–æ–‡ä»¶ï¼šsetup.binã€vmlinux.binï¼Œlinux/arch/x86/boot/toolsç›®å½•ä¸‹çš„buildã€‚è®©æˆ‘ä»¬æŒ¨ä¸ªæ¥åˆ†æä¸€ä¸‹ã€‚</p><p>å…¶å®ï¼Œbuildåªæ˜¯ä¸€ä¸ªHOSTOSï¼ˆæ­£åœ¨ä½¿ç”¨çš„Linuxï¼‰ä¸‹çš„åº”ç”¨ç¨‹åºï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†setup.binã€vmlinux.binä¸¤ä¸ªæ–‡ä»¶æ‹¼æ¥æˆä¸€ä¸ªbzImageæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/22/30/22a83b33b4eededec109bda203133830.jpg" alt="" title="bzImageæ–‡ä»¶ç»“æ„ç¤ºæ„å›¾"></p><p>å‰©ä¸‹çš„å°±æ˜¯ææ¸…æ¥šsetup.binã€vmlinux.binè¿™ä¸¤ä¸ªæ–‡ä»¶çš„çš„ç»“æ„ï¼Œå…ˆæ¥çœ‹çœ‹setup.binæ–‡ä»¶ï¼Œsetup.binæ–‡ä»¶æ˜¯ç”±objcopyå‘½ä»¤æ ¹æ®setup.elfç”Ÿæˆçš„ã€‚</p><p>setup.elfæ–‡ä»¶åˆæ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ç»“åˆåé¢çš„ä»£ç æ¥çœ‹çœ‹ã€‚</p><pre><code>#è¿™äº›ç›®æ ‡æ–‡ä»¶æ­£æ˜¯ç”±/arch/x86/boot/ç›®å½•ä¸‹å¯¹åº”çš„ç¨‹åºæºä»£ç æ–‡ä»¶ç¼–è¯‘äº§ç”Ÿ
setup-y     += a20.o bioscall.o cmdline.o copy.o cpu.o cpuflags.o cpucheck.o
setup-y     += early_serial_console.o edd.o header.o main.o memory.o
setup-y     += pm.o pmjump.o printf.o regs.o string.o tty.o video.o
setup-y     += video-mode.o version.o

#â€¦â€¦
SETUP_OBJS = $(addprefix $(obj)/,$(setup-y))
#â€¦â€¦
LDFLAGS_setup.elf   := -m elf_i386 -T$(obj)/setup.elf: $(src)/setup.ld $(SETUP_OBJS) FORCE    $(call if_changed,ld)
#â€¦â€¦
OBJCOPYFLAGS_setup.bin  := -O binary$(obj)/setup.bin: $(obj)/setup.elf FORCE    $(call if_changed,objcopy)
</code></pre><p>æ ¹æ®è¿™æ®µä»£ç ï¼Œä¸éš¾å‘ç°setup.binæ–‡ä»¶æ­£æ˜¯ç”±/arch/x86/boot/ç›®å½•ä¸‹ä¸€ç³»åˆ—å¯¹åº”çš„ç¨‹åºæºä»£ç æ–‡ä»¶ç¼–è¯‘é“¾æ¥äº§ç”Ÿï¼Œå…¶ä¸­çš„<strong>head.Sæ–‡ä»¶</strong>å’Œ<strong>main.cæ–‡ä»¶</strong>æ ¼å¤–é‡è¦ï¼Œåˆ«æ€¥ï¼Œè¿™ä¸ªæˆ‘ä¹‹åä¼šè®²ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹çœ‹vmlinux.binæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œæ„å»ºvmlinux.binçš„è§„åˆ™ä¾ç„¶åœ¨linux/arch/x86/boot/ç›®å½•ä¸‹çš„Makefileæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>#linux/arch/x86/boot/Makefile
OBJCOPYFLAGS_vmlinux.bin := -O binary -R .note -R .comment -S$(obj)/vmlinux.bin: $(obj)/compressed/vmlinux FORCE    $(call if_changed,objcopy)
</code></pre><p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œvmlinux.binæ–‡ä»¶ä¾èµ–äºlinux/arch/x86/boot/compressed/ç›®å½•ä¸‹çš„vmlinuxç›®æ ‡ï¼Œä¸‹é¢è®©æˆ‘ä»¬åˆ‡æ¢åˆ°linux/arch/x86/boot/compressed/ç›®å½•ä¸‹ç»§ç»­è¿½è¸ªã€‚æ‰“å¼€è¯¥ç›®å½•ä¸‹çš„Makefileï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹ä»£ç ã€‚</p><pre><code>#linux/arch/x86/boot/compressed/Makefile
#â€¦â€¦
#è¿™äº›ç›®æ ‡æ–‡ä»¶æ­£æ˜¯ç”±/arch/x86/boot/compressed/ç›®å½•ä¸‹å¯¹åº”çš„ç¨‹åºæºä»£ç æ–‡ä»¶ç¼–è¯‘äº§ç”Ÿ$(BITS)å–å€¼32æˆ–è€…64
vmlinux-objs-y := $(obj)/vmlinux.lds $(obj)/kernel_info.o $(obj)/head_$(BITS).o \    $(obj)/misc.o $(obj)/string.o $(obj)/cmdline.o $(obj)/error.o \    $(obj)/piggy.o $(obj)/cpuflags.o
vmlinux-objs-$(CONFIG_EARLY_PRINTK) += $(obj)/early_serial_console.o
vmlinux-objs-$(CONFIG_RANDOMIZE_BASE) += $(obj)/kaslr.o
ifdef CONFIG_X86_64    
vmlinux-objs-y += $(obj)/ident_map_64.o    
vmlinux-objs-y += $(obj)/idt_64.o $(obj)/idt_handlers_64.o    vmlinux-objs-y += $(obj)/mem_encrypt.o    
vmlinux-objs-y += $(obj)/pgtable_64.o    
vmlinux-objs-$(CONFIG_AMD_MEM_ENCRYPT) += $(obj)/sev-es.o
endif
#â€¦â€¦
$(obj)/vmlinux: $(vmlinux-objs-y) $(efi-obj-y) FORCE  
$(call if_changed,ld)
</code></pre><p>ç»“åˆè¿™æ®µä»£ç æˆ‘ä»¬å‘ç°ï¼Œlinux/arch/x86/boot/compressedç›®å½•ä¸‹çš„vmlinuxæ˜¯ç”±è¯¥ç›®å½•ä¸‹çš„head_32.oæˆ–è€…head_64.oã€cpuflags.oã€error.oã€kernel.oã€misc.oã€string.o ã€cmdline.o ã€early_serial_console.oç­‰æ–‡ä»¶ä»¥åŠpiggy.oé“¾æ¥è€Œæˆçš„ã€‚</p><p>å…¶ä¸­ï¼Œvmlinux.ldsæ˜¯é“¾æ¥è„šæœ¬æ–‡ä»¶ã€‚åœ¨æ²¡åšä»»ä½•ç¼–è¯‘åŠ¨ä½œå‰ï¼Œå‰é¢ä¾èµ–åˆ—è¡¨ä¸­ä»»ä½•ä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„æºæ–‡ä»¶ï¼ˆé™¤äº†piggy.oæºç ï¼‰ï¼Œæˆ‘ä»¬å‡ ä¹éƒ½å¯ä»¥åœ¨Linuxå†…æ ¸æºç é‡Œæ‰¾åˆ°ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œhead_64.oå¯¹åº”æºæ–‡ä»¶head_64.Sã€string.oå¯¹åº”æºæ–‡ä»¶string.cã€misc.oå¯¹åº”æºæ–‡ä»¶misc.cç­‰ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºå•¥æ‰¾ä¸åˆ°piggy.oå¯¹åº”çš„æºæ–‡ä»¶ï¼Œæ¯”å¦‚piggy.cã€piggy.Sæˆ–å…¶ä»–æ–‡ä»¶å‘¢ï¼Ÿä½ éœ€è¦åœ¨Makefileæ–‡ä»¶ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ï¼Œæ‰èƒ½å‘ç°æœ‰ä¸ªåˆ›å»ºæ–‡ä»¶piggy.Sçš„è§„åˆ™ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>#linux/arch/x86/boot/compressed/Makefile
#â€¦â€¦
quiet_cmd_mkpiggy = MKPIGGY $@      
cmd_mkpiggy = $(obj)/mkpiggy $&lt; &gt; $@

targets += piggy.S
$(obj)/piggy.S: $(obj)/vmlinux.bin.$(suffix-y) $(obj)/mkpiggy FORCE    $(call if_changed,mkpiggy)
</code></pre><p>çœ‹åˆ°ä¸Šé¢çš„è§„åˆ™ï¼Œæˆ‘ä»¬è±ç„¶å¼€æœ—ï¼ŒåŸæ¥piggy.oæ˜¯ç”±piggy.Sæ±‡ç¼–ä»£ç ç”Ÿæˆè€Œæ¥ï¼Œè€Œpiggy.Sæ˜¯ç¼–è¯‘Linuxå†…æ ¸æ—¶ç”±mkpiggyå·¥ä½œï¼ˆHOST OSä¸‹çš„åº”ç”¨ç¨‹åºï¼‰åŠ¨æ€åˆ›å»ºçš„ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰¾ä¸åˆ°å®ƒçš„åŸå› ã€‚</p><p>piggy.Sçš„ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶vmlinux.bin.$(suffix-y)ä¸­çš„suffix-yï¼Œå®ƒè¡¨ç¤ºå†…æ ¸å‹ç¼©æ–¹å¼å¯¹åº”çš„åç¼€ã€‚</p><pre><code>#linux/arch/x86/boot/compressed/Makefile
#â€¦â€¦
vmlinux.bin.all-y := $(obj)/vmlinux.bin
vmlinux.bin.all-$(CONFIG_X86_NEED_RELOCS) += $(obj)/vmlinux.relocs
$(obj)/vmlinux.bin.gz: $(vmlinux.bin.all-y) FORCE    
$(call if_changed,gzip)
$(obj)/vmlinux.bin.bz2: $(vmlinux.bin.all-y) FORCE    
$(call if_changed,bzip2)
$(obj)/vmlinux.bin.lzma: $(vmlinux.bin.all-y) FORCE    
$(call if_changed,lzma)
$(obj)/vmlinux.bin.xz: $(vmlinux.bin.all-y) FORCE   
$(call if_changed,xzkern)
$(obj)/vmlinux.bin.lzo: $(vmlinux.bin.all-y) FORCE    
$(call if_changed,lzo)
$(obj)/vmlinux.bin.lz4: $(vmlinux.bin.all-y) FORCE    
$(call if_changed,lz4)
$(obj)/vmlinux.bin.zst: $(vmlinux.bin.all-y) FORCE    
$(call if_changed,zstd22)
suffix-$(CONFIG_KERNEL_GZIP)    := gz
suffix-$(CONFIG_KERNEL_BZIP2)   := bz2
suffix-$(CONFIG_KERNEL_LZMA)    := lzma
suffix-$(CONFIG_KERNEL_XZ)  := xz
suffix-$(CONFIG_KERNEL_LZO)     := lzo
suffix-$(CONFIG_KERNEL_LZ4)     := lz4
suffix-$(CONFIG_KERNEL_ZSTD)    := zst
</code></pre><p>ç”±å‰é¢å†…å®¹å¯ä»¥å‘ç°ï¼ŒLinuxå†…æ ¸å¯ä»¥è¢«å‹ç¼©æˆå¤šç§æ ¼å¼ã€‚è™½ç„¶ç°åœ¨æˆ‘ä»¬ä¾ç„¶æ²¡æœ‰ææ¸…æ¥švmlinux.binæ–‡ä»¶æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œlinux/arch/x86/boot/compressedç›®å½•ä¸‹çš„Makefileæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸‹é¢è¿™æ ·çš„ä»£ç ã€‚</p><pre><code>#linux/arch/x86/boot/compressed/Makefile
#â€¦â€¦
OBJCOPYFLAGS_vmlinux.bin :=  -R .comment -S
$(obj)/vmlinux.bin: vmlinux FORCE 
$(call if_changed,objcopy)
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œarch/x86/boot/compressedç›®å½•ä¸‹çš„vmlinux.binï¼Œå®ƒæ˜¯ç”±objcopyå·¥å…·é€šè¿‡vmlinuxç›®æ ‡ç”Ÿæˆã€‚è€Œvmlinuxç›®æ ‡æ²¡æœ‰ä»»ä½•ä¿®é¥°å‰ç¼€å’Œä¾èµ–çš„ç›®æ ‡ï¼Œè¿™è¯´æ˜å®ƒå°±æ˜¯<strong>æœ€é¡¶å±‚ç›®å½•ä¸‹çš„ä¸€ä¸ªvmlinuxæ–‡ä»¶</strong>ã€‚</p><p>æˆ‘ä»¬ç»§ç»­æ·±ç©¶ä¸€æ­¥å°±ä¼šå‘ç°ï¼Œobjcopyå·¥å…·åœ¨å¤„ç†è¿‡ç¨‹ä¸­åªæ˜¯åˆ é™¤äº†vmlinuxæ–‡ä»¶ä¸­â€œ.commentâ€æ®µï¼Œä»¥åŠç¬¦å·è¡¨å’Œé‡å®šä½è¡¨ï¼ˆé€šè¿‡å‚æ•°-SæŒ‡å®šï¼‰ï¼Œè€Œvmlinuxæ–‡ä»¶çš„æ ¼å¼ä¾ç„¶æ˜¯ELFæ ¼å¼çš„ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨ELFæ ¼å¼çš„å†…æ ¸ï¼Œè¿™é‡Œæ·»åŠ â€œ-O binaryâ€é€‰é¡¹å°±å¯ä»¥äº†ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æ¥æ¢³ç†ä¸€ä¸‹ï¼Œvmlinuxæ–‡ä»¶æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚</p><p>å…¶å®ï¼Œvmlinuxæ–‡ä»¶å°±æ˜¯ç¼–è¯‘æ•´ä¸ªLinuxå†…æ ¸æºä»£ç æ–‡ä»¶ç”Ÿæˆçš„ï¼ŒLinuxçš„ä»£ç åˆ†å¸ƒåœ¨å„ä¸ªä»£ç ç›®å½•ä¸‹ï¼Œè¿™äº›ç›®å½•ä¹‹ä¸‹åˆå­˜åœ¨ç›®å½•ï¼ŒLinuxçš„kbuildï¼ˆå†…æ ¸ç¼–è¯‘ï¼‰ç³»ç»Ÿï¼Œä¼šé€’å½’è¿›å…¥åˆ°æ¯ä¸ªç›®å½•ï¼Œç”±è¯¥ç›®å½•ä¸‹çš„Makefileå†³å®šè¦ç¼–è¯‘å“ªäº›æ–‡ä»¶ã€‚</p><p>åœ¨ç¼–è¯‘å®Œå…·ä½“æ–‡ä»¶ä¹‹åï¼Œå°±ä¼šåœ¨è¯¥ç›®å½•ä¸‹ï¼ŒæŠŠå·²ç»ç¼–è¯‘äº†çš„æ–‡ä»¶é“¾æ¥æˆä¸€ä¸ªè¯¥ç›®å½•ä¸‹çš„built-in.oæ–‡ä»¶ï¼Œè¿™ä¸ªbuilt-in.oæ–‡ä»¶ä¹Ÿä¼šä¸ä¸Šå±‚ç›®å½•çš„built-in.oæ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·ã€‚</p><p>å†ç„¶åï¼Œå±‚å±‚ç›®å½•è¿”å›åˆ°é¡¶å±‚ç›®å½•ï¼Œæ‰€æœ‰çš„built-in.oæ–‡ä»¶ä¼šé“¾æ¥ç”Ÿæˆä¸€ä¸ªvmlinuxæ–‡ä»¶ï¼Œè¿™ä¸ªvmlinuxæ–‡ä»¶ä¼šé€šè¿‡å‰é¢çš„æ–¹æ³•è½¬æ¢æˆvmlinux.binæ–‡ä»¶ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œvmlinux.binæ–‡ä»¶å®ƒä¾ç„¶æ˜¯ELFæ ¼å¼çš„æ–‡ä»¶ã€‚</p><p>æœ€åï¼Œå·¥å…·è½¯ä»¶ä¼šå‹ç¼©æˆvmlinux.bin.gzæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥gzipæ–¹å¼å‹ç¼©ã€‚</p><p>è®©æˆ‘ä»¬å†æ¬¡å›åˆ°mkpiggyå‘½ä»¤ï¼Œå…¶ä¸­mkpiggyæ˜¯å†…æ ¸è‡ªå¸¦çš„ä¸€ä¸ªå·¥å…·ç¨‹åºï¼Œå®ƒæŠŠè¾“å‡ºæ–¹å¼é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œä»è€Œäº§ç”Ÿpiggy.Sæ±‡ç¼–æ–‡ä»¶ï¼Œæºç å¦‚ä¸‹ï¼š</p><pre><code>int main(int argc, char *argv[]){ 
    uint32_t olen;    
    long ilen;    
    FILE *f = NULL;    
    int retval = 1;
    f = fopen(argv[1], &quot;r&quot;);    
    if (!f) {        
        perror(argv[1]);        
        goto bail;    
    }
    //â€¦â€¦ä¸ºèŠ‚çº¦ç¯‡å¹…ç•¥å»éƒ¨åˆ†ä»£ç 
    printf(&quot;.section \&quot;.rodata..compressed\&quot;,\&quot;a\&quot;,@progbits\n&quot;);
    printf(&quot;.globl z_input_len\n&quot;);    
    printf(&quot;z_input_len = %lu\n&quot;, ilen);    
    printf(&quot;.globl z_output_len\n&quot;);    
    printf(&quot;z_output_len = %lu\n&quot;, (unsigned long)olen);
    printf(&quot;.globl input_data, input_data_end\n&quot;);
    printf(&quot;input_data:\n&quot;);    
    printf(&quot;.incbin \&quot;%s\&quot;\n&quot;, argv[1]);    
    printf(&quot;input_data_end:\n&quot;);
    printf(&quot;.section \&quot;.rodata\&quot;,\&quot;a\&quot;,@progbits\n&quot;);
    printf(&quot;.globl input_len\n&quot;);    
    printf(&quot;input_len:\n\t.long %lu\n&quot;, ilen);    
    printf(&quot;.globl output_len\n&quot;);    
    printf(&quot;output_len:\n\t.long %lu\n&quot;, (unsigned long)olen);
    retval = 0;
bail:    
    if (f)        
        fclose(f);    
    return retval;
}
//ç”±ä¸Šmkpiggyç¨‹åºâ€œå†™çš„â€ä¸€ä¸ªæ±‡ç¼–ç¨‹åºpiggy.Sã€‚
.section &quot;.rodata..compressed&quot;,&quot;a&quot;,@progbits 
.globl z_input_len
 z_input_len = 1921557 
.globl z_output_len 
z_output_len = 3421472 
.globl input_data,input_data_end
.incbin &quot;arch/x86/boot/compressed/vmlinux.bin.gz&quot; 
input_data_end:
.section &quot;.rodata&quot;,&quot;a&quot;,@progbits
.globl input_len
input_len:4421472
.globl output_len
output_len:4424772
</code></pre><p>æ ¹æ®ä¸Šè¿°ä»£ç ä¸éš¾å‘ç°ï¼Œè¿™ä¸ªpiggy.Séå¸¸ç®€å•ï¼Œä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤incbinå°†å‹ç¼©çš„vmlinux.bin.gzæ¯«æ— ä¿®æ”¹åœ°åŒ…å«è¿›æ¥ã€‚</p><p>é™¤äº†åŒ…å«äº†å‹ç¼©çš„vmlinux.bin.gzå†…æ ¸æ˜ åƒæ–‡ä»¶å¤–ï¼Œpiggy.Sä¸­è¿˜å®šä¹‰äº†è§£å‹vmlinux.bin.gzæ—¶éœ€è¦çš„å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‹ç¼©å†…æ ¸æ˜ åƒçš„é•¿åº¦ã€è§£å‹åçš„é•¿åº¦ç­‰ä¿¡æ¯ã€‚</p><p><strong>è¿™äº›ä¿¡æ¯å’Œvmlinux.bin.gzæ–‡ä»¶ï¼Œå®ƒä»¬ä¸€èµ·ç”Ÿæˆäº†piggy.oæ–‡ä»¶ï¼Œç„¶åpiggy.oæ–‡ä»¶å’Œ<span dollar="">$</span>(vmlinux-objs-y)<span dollar="">$</span>(efi-obj-y)ä¸­çš„ç›®æ ‡æ–‡ä»¶ä¸€èµ·é“¾æ¥ç”Ÿæˆï¼Œæœ€ç»ˆç”Ÿæˆäº†linux/arch/x86/boot/compressedç›®å½•ä¸‹çš„vmlinuxã€‚</strong></p><p>è¯´åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰ï¼Œè¿™å’ŒLinuxçš„å¯åŠ¨æµç¨‹æ— å…³å‘¢ï¼Ÿæœ‰è¿™ç§æƒ³æ³•å°±å¤§é”™ç‰¹é”™äº†ï¼Œè¦æƒ³ææ˜ç™½Linuxçš„å¯åŠ¨æµç¨‹ï¼Œé¦–å…ˆå¾—ææ‡‚å®ƒvmlinuzçš„æ–‡ä»¶ç»“æ„ã€‚æœ‰äº†è¿™äº›åŸºç¡€ï¼Œæ‰èƒ½çŸ¥å…¶ç„¶åŒæ—¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>åˆåˆ°äº†è¯¾ç¨‹å°¾å£°ï¼Œè¿™èŠ‚è¯¾çš„å­¦ä¹ æˆ‘ä»¬å°±å‘Šä¸€æ®µè½äº†ï¼Œæˆ‘æ¥ç»™ä½ åšä¸ªæ€»ç»“ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬é¦–å…ˆä»å…¨å±€æ¢³ç†äº†ä¸€éx86å¹³å°çš„å¯åŠ¨æµç¨‹ï¼ŒæŒæ¡äº†BIOSåŠ è½½GRUBçš„è¿‡ç¨‹ï¼Œåˆä¸€èµ·å­¦ä¹ äº†BIOSæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Œå®ƒåˆæ˜¯å¦‚ä½•åŠ è½½å¼•å¯¼è®¾å¤‡çš„ã€‚</p><p>æ¥ç€æˆ‘ä»¬ç ”ç©¶äº†GRUBçš„å¯åŠ¨æµç¨‹ï¼ŒBIOSåŠ è½½äº†GRUBçš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†åŠ è½½äº†GRUBçš„å…¶ä½™éƒ¨åˆ†ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è¯¦ç»†äº†è§£äº†Linuxå†…æ ¸çš„å¯åŠ¨æ–‡ä»¶vmlinuzçš„ç»“æ„ï¼Œææ¸…æ¥šäº†å®ƒçš„ç”Ÿæˆè¿‡ç¨‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·é—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨Cä»£ç mkpiggyç¨‹åºç”Ÿæˆpiggy.Sæ–‡ä»¶ï¼Œå¹¶åŒ…å«vmlinux.bin.gzæ–‡ä»¶å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ”¶è·å’Œç–‘é—®ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹ï¼Œè·Ÿä»–ä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚</p><p>å¥½ï¼Œæˆ‘æ˜¯LMOSï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            springXu  2021-06-09 00:48:56
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            ç¨‹åºæ¥ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œè¿™ä¸ªæ˜¯æœ‰å¤šç§é…ç½®è®©ä½¿ç”¨è€…æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥ç”Ÿæˆã€‚æ¯”å¦‚vmlinuz.binå‹ç¼©çš„æ–¹å¼çš„ä¸åŒåˆæˆ–è€…æ˜¯cpuçš„æŒ‡ä»¤ä¸åŒã€‚  äº§ç”Ÿçš„æ±‡ç¼–ä»£ç ä¹Ÿä¸åŒã€‚ å¦å¤–Cosmos.ekiçš„ç”Ÿæˆè¿‡ç¨‹èƒ½æœ‰ä¸ªè¯´æ˜ä¸ï¼Ÿ  [2èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2021-06-09 21:26:53</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">æˆ‘è¯¾ç¨‹ä¸­æœ‰ç”Ÿæˆekiæ–‡ä»¶çš„æ–¹å¼</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            neohope  2021-06-10 21:59:06
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            å¤§ä½“ä¸Šæ•´ç†äº†ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜æ¬¢è¿å¸®å¿™æŒ‡å‡ºã€ä¸Šã€‘ï¼š<br><br>æ“ä½œç³»ç»Ÿçš„å¯åŠ¨åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šå¼•å¯¼bootå’Œå¯åŠ¨startupï¼Œæœ¬èŠ‚ä¸»è¦è¿˜æ˜¯bootè¿‡ç¨‹ï¼š<br>BIOS-&gt;GRUG1-&gt;GRUB1.5-&gt;GRUB2-&gt;Linuxå†…æ ¸ã€ç¯å¢ƒç¡¬ç›˜å¼•å¯¼ã€MBRåˆ†åŒºã€‘<br><br>1ã€æŒ‰ç”µæºé”®ï¼Œç³»ç»ŸåŠ ç”µ<br><br>2ã€ä¸»æ¿é€šç”µ<br>CPUåŠ ç”µæ—¶ï¼Œä¼šé»˜è®¤è®¾ç½®[CS:IP]ä¸º[0XF000:0XFFF0]ï¼Œæ ¹æ®å®æ¨¡å¼ä¸‹å¯»å€è§„åˆ™ï¼ŒCPUæŒ‡å‘0XFFFF0<br>è¿™ä¸ªåœ°å€æ­£æ˜¯BIOSå¯åŠ¨ç¨‹åºä½ç½®ï¼Œè€ŒBIOSè®¿é—®æ–¹å¼ä¸å†…å­˜ä¸€è‡´ï¼Œæ‰€ä»¥CPUå¯ä»¥ç›´æ¥è¯»å–å‘½ä»¤å¹¶æ‰§è¡Œ<br><br>3ã€BIOSæ‰§è¡Œ<br>3.1ã€BIOSé¦–å…ˆæ‰§è¡ŒPOSTè‡ªæ£€ï¼ŒåŒ…æ‹¬ä¸»æ¿ã€å†…å­˜ã€å¤–è®¾ç­‰ï¼Œé‡åˆ°é—®é¢˜åˆ™æŠ¥è­¦å¹¶åœæ­¢å¼•å¯¼<br><br>3.2ã€BIOSå¯¹è®¾å¤‡æ‰§è¡Œç®€å•çš„åˆå§‹åŒ–å·¥ä½œ<br><br>3.3ã€BIOS ä¼šåœ¨å†…å­˜ä¸­ï¼š<br>å»ºç«‹ä¸­æ–­è¡¨ï¼ˆ0x00000~0x003FFï¼‰<br>æ„å»º BIOS æ•°æ®åŒºï¼ˆ0x00400~0x004FFï¼‰<br>åŠ è½½äº†ä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆ0x0e05b~0x1005Aï¼‰<br><br>3.4ã€BIOSæ ¹æ®è®¾å¤‡å¯åŠ¨é¡ºåºï¼Œä¾æ¬¡åˆ¤æ–­æ˜¯å¦å¯ä»¥å¯åŠ¨<br>æ¯”å¦‚å…ˆæ£€æŸ¥å…‰é©±èƒ½å¦å¯åŠ¨<br>ç„¶åä¾æ¬¡æ£€æŸ¥ç¡¬ç›˜æ˜¯å¦å¯ä»¥å¯åŠ¨ã€ç¡¬ç›˜åˆ†åŒºçš„æ—¶å€™ï¼Œè®¾ç½®ä¸ºæ´»åŠ¨åˆ†åŒºã€‘<br><br>4ã€ç¡¬ç›˜å¼•å¯¼<br>4.1ã€å…ˆè¯´ä¸‹å¯»å€æ–¹å¼ï¼Œä¸æ‰‡åŒºç¼–å·çš„äº‹æƒ…<br>æœ€ä¼ ç»Ÿçš„ç£ç›˜å¯»å€æ–¹å¼ä¸ºCHSï¼Œç”±ä¸‰ä¸ªå‚æ•°å†³å®šè¯»å–å“ªä¸ªæ‰‡åŒºï¼šç£å¤´ï¼ˆHeadsï¼‰ã€æŸ±é¢(Cylinder)ã€æ‰‡åŒº(Sector)<br>ç£å¤´æ•°ã€8ä½ã€‘ï¼Œä»0å¼€å§‹ï¼Œæœ€å¤§255ã€å¾®è½¯DOSç³»ç»Ÿï¼Œåªèƒ½ç”¨255ä¸ªã€‘ï¼Œå†³å®šäº†è¯»å–å“ªä¸ªç›˜ç‰‡çš„å“ªä¸ªé¢ã€ä¸€ç›˜ä¸¤é¢ã€‘<br>æŸ±é¢æ•°ã€10ä½ã€‘ï¼Œä»0å¼€å§‹ï¼Œæœ€å¤§1023ã€å†³å®šäº†è¯»å–å“ªä¸ªç£é“ï¼Œç£é“æ— è®ºé•¿çŸ­éƒ½ä¼šåˆ’åˆ†ä¸ºç›¸åŒæ‰‡åŒºæ•°ã€‘<br>æ‰‡åŒºæ•°ã€6ä½ã€‘ï¼Œä»1å¼€å§‹ï¼Œæœ€å¤§æ•° 63ã€CHSä¸­æ‰‡åŒºä»1å¼€å§‹ï¼Œè€Œé€»è¾‘åˆ’åˆ†ä¸­æ‰‡åŒºä»0å¼€å§‹ï¼Œç»å¸¸ä¼šé€ æˆå¾ˆå¤šè¯¯è§£ã€‘<br>æ¯ä¸ªæ‰‡åŒºä¸º512å­—èŠ‚<br><br>4.2ã€ç„¶åè¯´ä¸‹å¼•å¯¼æ–¹å¼<br>BIOSåœ¨å‘ç°ç¡¬ç›˜å¯åŠ¨æ ‡å¿—åï¼ŒBIOSä¼šå¼•å‘INT 19Hä¸­æ–­<br>è¿™ä¸ªæ“ä½œï¼Œä¼šå°†MBRã€é€»è¾‘0æ‰‡åŒºã€‘ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜CHSã€ç£å¤´0ï¼ŒæŸ±é¢0ï¼Œæ‰‡åŒº1ã€‘ï¼Œè¯»å–åˆ°å†…å­˜[0:7C00h]ï¼Œç„¶åæ‰§è¡Œå…¶ä»£ç ã€GRUB1é˜¶æ®µã€‘ï¼Œè‡³æ­¤BIOSæŠŠä¸»åŠ¨æƒäº¤ç»™äº†GRUB1é˜¶æ®µä»£ç <br>MBRæ‰‡åŒºä¸º512å­—èŠ‚ï¼Œæ‰‡åŒºæœ€ååˆ†åŒºè¡¨è‡³å°‘éœ€è¦66å­—èŠ‚ã€64å­—èŠ‚DPT+2å­—èŠ‚å¼•å¯¼æ ‡å¿—ã€‘ï¼Œæ‰€ä»¥è¿™æ®µä»£ç æœ€å¤šåªèƒ½æœ‰446å­—èŠ‚ï¼Œgrubä¸­å¯¹åº”çš„å°±æ˜¯å¼•å¯¼é•œåƒboot.img<br>boot.imgçš„ä»»åŠ¡å°±æ˜¯ï¼Œå®šä½ï¼Œå¹¶é€šè¿‡BIOS INT13ä¸­æ–­è¯»å–1.5é˜¶æ®µä»£ç ï¼Œå¹¶è¿è¡Œ<br><br>5ã€Grub1.5é˜¶æ®µ<br>5.1ã€å…ˆè¯´ä¸€ä¸‹MBR GAP<br>æ®è¯´å¾®è½¯DOSç³»ç»ŸåŸå› ï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºçš„èµ·å§‹é€»è¾‘æ‰‡åŒºæ˜¯63æ‰‡åŒºï¼Œåœ¨MBRã€0æ‰‡åŒºã€‘å’Œåˆ†å¸ƒè¡¨ä¹‹é—´ã€63æ‰‡åŒºã€‘ï¼Œå­˜åœ¨62ä¸ªç©ºç™½æ‰‡åŒºï¼Œå…± 31KBã€‚<br>Grub1.5é˜¶æ®µä»£ç å°±å®‰è£…åœ¨è¿™é‡Œã€‚<br><br>5.2ã€ä¸Šé¢æåˆ°ï¼Œboot.imgä¸»è¦åŠŸèƒ½å°±æ˜¯æ‰¾åˆ°å¹¶åŠ è½½Grub1.5é˜¶æ®µä»£ç ï¼Œå¹¶åˆ‡æ¢æ‰§è¡Œã€‚<br>Grub1.5é˜¶æ®µä»£ç æ˜¯core.imgï¼Œå…¶ä¸»è¦åŠŸèƒ½å°±æ˜¯åŠ è½½æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼ŒæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œ ä½åŠ è½½å¹¶è¿è¡ŒGRUB2é˜¶æ®µä»£ç ã€‚<br>core.imgåŒ…æ‹¬å¤šä¸ªæ˜ åƒå’Œæ¨¡å—ï¼š<br>diskboot.imgã€1.5é˜¶æ®µå¼•å¯¼ç¨‹åºã€‘ï¼Œå­˜åœ¨äºMBR GAPç¬¬ä¸€ä¸ªæ‰‡åŒºï¼›ã€è¿™é‡Œæ˜¯ç¡¬ç›˜å¯åŠ¨çš„æƒ…å†µï¼Œå¦‚æœæ˜¯cdå¯åŠ¨å°±ä¼šæ˜¯cdboot.imgã€‘<br>lzma_decompress.imgã€è§£å‹ç¨‹åºã€‘<br>kernel.imgã€grubæ ¸å¿ƒä»£ç ã€‘ï¼Œä¼šã€å‹ç¼©å­˜æ”¾ã€‘<br>biosdisk.modã€ç£ç›˜é©±åŠ¨ã€‘ã€Part_msdos.modã€MBRåˆ†åŒºæ”¯æŒã€‘ã€Ext2.modã€EXTæ–‡ä»¶ç³»ç»Ÿã€‘ç­‰ï¼Œä¼šã€å‹ç¼©å­˜æ”¾ã€‘<br><br>å…¶å®boot.imgåªåŠ è½½äº†core.imgçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºã€å­˜æ”¾diskboot.imgã€‘ï¼Œç„¶åæ§åˆ¶æƒå°±äº¤å‡ºå»äº†ï¼Œgrubé˜¶æ®µ1ä»£ç ä½¿å‘½ç»“æŸã€‚<br>diskboot.imgçŸ¥é“åç»­æ¯ä¸ªæ–‡ä»¶çš„ä½ç½®ï¼Œä¼šç»§ç»­é€šè¿‡BIOSä¸­æ–­è¯»å–æ‰‡åŒºï¼ŒåŠ è½½ä½™ä¸‹çš„éƒ¨åˆ†å¹¶è½¬äº¤æ§åˆ¶æƒï¼ŒåŒ…æ‹¬ï¼š<br>åŠ è½½lzma_decompress.imgï¼Œä»è€Œå¯ä»¥è§£å‹è¢«å‹ç¼©çš„æ¨¡å—<br>åŠ è½½kernel.imgï¼Œå¹¶è½¬äº¤æ§åˆ¶æƒç»™kernel.img<br>kernel.imgçš„grub_mainå‡½æ•°ä¼šè°ƒç”¨grub_load_moduleså‡½æ•°åŠ è½½å„ä¸ªmodæ¨¡å—<br>åŠ è½½å„ä¸ªmodåï¼Œgrubå°±æ”¯æŒæ–‡ä»¶ç³»ç»Ÿäº†ï¼Œè®¿é—®ç£ç›˜ä¸éœ€è¦å†ä¾é BIOSçš„ä¸­æ–­ä»¥æ‰‡åŒºä¸ºå•ä½è¯»å–äº†ï¼Œç»ˆäºå¯ä»¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿäº† [2èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Fan  2021-06-09 11:39:57
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            åˆå­¦ä¹ äº†ä¸€éå¯åŠ¨æµç¨‹ã€‚ğŸ˜‚ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ç¼–è¾‘å›å¤2021-06-09 13:50:49</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">æ¥äº†è€é“ï¼Œå¯åŠ¨æµç¨‹ï¼Œå¸¸çœ‹å¸¸æ–°ï½</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            neohope  2021-06-10 21:59:24
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            å¤§ä½“ä¸Šæ•´ç†äº†ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜æ¬¢è¿å¸®å¿™æŒ‡å‡ºã€ä¸‹ã€‘ï¼š<br>6ã€GRUB2é˜¶æ®µ<br>ç°åœ¨grubå°±èƒ½è®¿é—®boot&#47;grubåŠå…¶å­ç›®å½•äº†<br>kernel.imgæ¥ç€è°ƒç”¨grub_load_normal_modeåŠ è½½normalæ¨¡å—<br>normalæ¨¡å—è¯»å–è§£ææ–‡ä»¶grub.cfgï¼ŒæŸ¥çœ‹æœ‰å“ªäº›å‘½ä»¤ï¼Œæ¯”å¦‚å‘ç°äº†linuxã€initrdè¿™å‡ ä¸ªå‘½ä»¤ï¼Œéœ€è¦linuxæ¨¡å—<br>normalæ¨¡å—ä¼šæ ¹æ®command.lstï¼Œå®šä½å¹¶åŠ è½½ç”¨åˆ°çš„linuxæ¨¡å—ã€ä¸€èˆ¬åœ¨&#47;boot&#47;grub2&#47;i386-pcç›®å½•ã€‘<br>å½“ç„¶ï¼ŒåŒæ—¶éœ€è¦å®Œæˆåˆå§‹åŒ–æ˜¾ç¤ºã€è½½å…¥å­—ä½“ç­‰å·¥ä½œ<br>æ¥ä¸‹æ¥Grubå°±ä¼šç»™å’±ä»¬å±•ç¤ºå¯åŠ¨èœå•äº†<br><br>7ã€é€‰æ‹©å¯åŠ¨èœå•<br>7.1ã€å¼•å¯¼åè®®<br>å¼•å¯¼ç¨‹åºåŠ è½½å†…æ ¸ï¼Œå‰ææ˜¯ç¡®å®šå¥½æ•°æ®äº¤æ¢æ–¹å¼ï¼Œå«åšå¼•å¯¼åè®®ï¼Œå†…æ ¸ä¸­å¼•å¯¼åè®®ç›¸å…³éƒ¨åˆ†çš„ä»£ç åœ¨arch&#47;x86&#47;boot&#47;header.Sä¸­ï¼Œå†…æ ¸ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ ‡æ˜è‡ªå·±çš„å¯¹é½è¦æ±‚ã€æ˜¯å¦å¯ä»¥é‡å®šä½ä»¥åŠå¸Œæœ›çš„åŠ è½½åœ°å€ç­‰ä¿¡æ¯ã€‚åŒæ—¶ä¹Ÿä¼šé¢„ç•™ç©ºä½ï¼Œç”±å¼•å¯¼åŠ è½½ç¨‹åºåœ¨åŠ è½½å†…æ ¸æ—¶å¡«å……ï¼Œæ¯”å¦‚initramfsçš„åŠ è½½ä½ç½®å’Œå¤§å°ç­‰ä¿¡æ¯ã€‚<br>å¼•å¯¼åŠ è½½ç¨‹åºå’Œå†…æ ¸å‡ä¸ºæ­¤å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“linux_kernel_paramsï¼Œç§°ä¸ºå¼•å¯¼å‚æ•°ï¼Œç”¨äºå‚æ•°è®¾å®šã€‚Grubä¼šåœ¨æŠŠæ§åˆ¶æƒç§»äº¤ç»™å†…æ ¸ä¹‹å‰ï¼Œå¡«å……å¥½linux_kernel_paramsç»“æ„ä½“ã€‚å¦‚æœç”¨æˆ·è¦é€šè¿‡grubå‘å†…æ ¸ä¼ é€’å¯åŠ¨å‚æ•°ï¼Œå³grub.cfgä¸­linuxåé¢çš„å‘½ä»¤è¡Œå‚æ•°ã€‚Grubä¹Ÿä¼šæŠŠè¿™éƒ¨åˆ†ä¿¡æ¯å…³è”åˆ°å¼•å¯¼å‚æ•°ç»“æ„ä½“ä¸­ã€‚<br><br>7.2ã€å¼€å§‹å¼•å¯¼<br>Linuxå†…æ ¸çš„ç›¸å…³æ–‡ä»¶ä½äº&#47;boot ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åå‡å¸¦æœ‰å‰ç¼€ vmlinuzã€‚<br>å’±ä»¬é€‰æ‹©å¯¹åº”çš„èœå•åï¼ŒGrubä¼šå¼€å§‹æ‰§è¡Œå¯¹åº”å‘½ä»¤ï¼Œå®šä½ã€åŠ è½½ã€åˆå§‹åŒ–å†…æ ¸ï¼Œå¹¶ç§»äº¤åˆ°å†…æ ¸ç»§ç»­æ‰§è¡Œã€‚<br>è°ƒç”¨linuxæ¨¡å—ä¸­çš„linuxå‘½ä»¤ï¼ŒåŠ è½½linuxå†…æ ¸<br>è°ƒç”¨linuxæ¨¡å—ä¸­çš„initrdå‘½ä»¤ï¼Œå¡«å……initramfsä¿¡æ¯ï¼Œç„¶åGrubä¼šæŠŠæ§åˆ¶æƒç§»äº¤ç»™å†…æ ¸ã€‚<br>å†…æ ¸æ­¤æ—¶å¼€å§‹æ‰§è¡Œï¼ŒåŒæ—¶ä¹Ÿå°±å¯ä»¥è¯»å–linux_kernel_paramsç»“æ„ä½“çš„æ•°æ®äº†<br>booté˜¶æ®µç»“æŸï¼Œå¼€å§‹è¿›å…¥startupé˜¶æ®µã€‚ [1èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            å­¤æ˜Ÿå¯  2021-06-10 11:31:19
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            å°è¯•å®ç°äº† lmoskrlimg çš„é€»è¾‘ï¼ˆå³ Cosmos.eki çš„ç”Ÿæˆï¼‰ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ã€‚<br><br>https:&#47;&#47;github.com&#47;guxingke&#47;demo&#47;blob&#47;master&#47;bytes-demo&#47;src&#47;main&#47;java&#47;com&#47;gxk&#47;demo&#47;Main.java [1èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            blentle  2021-06-10 08:53:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            ä¸ç®¡è‚šå­å¤šå°‘éå¯åŠ¨æµç¨‹ï¼Œè¿˜æ˜¯è®°ä¸ä½å„ç§åœ°å€ï¼Œé™¤äº†0Ã—7c00ï¼Œå“ˆå“ˆ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            è€ç‹  2021-06-09 15:39:04
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            éœ€è¦å¤šåˆ†æå„ä¸ªè„šæœ¬çš„åŠŸèƒ½ï¼Œæ‰èƒ½æŠŠæ¡ä½è„‰ç»œ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2021-06-09 21:23:20</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">æ˜¯çš„ï¼Œlinuxå¤ªå¤§äº†<br></div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Fan  2021-06-09 12:58:45
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            è¯·é—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ C ä»£ç  mkpiggy ç¨‹åºç”Ÿæˆ piggy.S æ–‡ä»¶ï¼Œå¹¶åŒ…å« vmlinux.bin.gz æ–‡ä»¶å‘¢ï¼Ÿ<br><br>çœ‹äº†è¿™ä¸‹ç”Ÿæˆçš„è¿™ä¸ªpiggy.S æ–‡ä»¶<br>ä¸»è¦çš„å°±æ˜¯è¿™è¡Œä»£ç <br>.incbin &quot;arch&#47;x86&#47;boot&#47;compressed&#47;vmlinux.bin.gz&quot;<br>é€šè¿‡C ä»£ç çš„å½¢å¼ï¼Œå¯ä»¥ä¼ å…¥ä¸åŒçš„å‚æ•°æ¥è®¾ç½®ä¸åŒçš„å‹ç¼©åŒ…vmlinux.bin.xx  æ¥ç”Ÿæˆpiggy.S ã€‚<br> 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2021-06-09 21:24:43</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">è¿™å°±æ˜¯å¼€æºä½œè€…çš„å–œå¥½äº† </div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            pedro  2021-06-09 10:10:57
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            å·¥å…·ç”Ÿæˆæ–¹å¼çµæ´»ï¼Œæ”¯æŒå¤šç§é…ç½®ï¼Œä¸”èƒ½æ»¡è¶³å„ç§åœºæ™¯ä¸‹çš„éœ€æ±‚~ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2021-06-09 21:24:53</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">æ˜¯çš„ å¯¹å¤´</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>