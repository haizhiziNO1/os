<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>22-å¤„ç†æ•°æ®ç±»å‹å˜åŒ–å’Œé”™è¯¯ï¼šoptionalã€variantã€expectedå’ŒHerbception</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>22-å¤„ç†æ•°æ®ç±»å‹å˜åŒ–å’Œé”™è¯¯ï¼šoptionalã€variantã€expectedå’ŒHerbception</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>æˆ‘ä»¬ä¹‹å‰å·²ç»è®¨è®ºäº†å¼‚å¸¸æ˜¯æ¨èçš„ C++ é”™è¯¯å¤„ç†æ–¹å¼ã€‚ä¸è¿‡ï¼ŒC++ é‡Œæœ‰å¦å¤–ä¸€äº›ç»“æ„ä¹Ÿå¾ˆé€‚åˆè¿›è¡Œé”™è¯¯å¤„ç†ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥è®¨è®ºä¸€ä¸‹ã€‚</p><h2>optional</h2><p>åœ¨é¢å‘å¯¹è±¡ï¼ˆå¼•ç”¨è¯­ä¹‰ï¼‰çš„è¯­è¨€é‡Œï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šä½¿ç”¨ç©ºå€¼ null è¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°éœ€è¦çš„å¯¹è±¡ã€‚ä¹Ÿæœ‰äººæ¨èä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå¯¹è±¡ï¼Œæ¥é¿å…ç©ºå€¼å¸¦æ¥çš„ä¸€äº›é—®é¢˜ <span class="orange">[1]</span>ã€‚å¯ä¸ç®¡æ˜¯ç©ºå€¼ï¼Œè¿˜æ˜¯ç©ºå¯¹è±¡ï¼Œå¯¹äºä¸€ä¸ªè¿”å›æ™®é€šå¯¹è±¡ï¼ˆå€¼è¯­ä¹‰ï¼‰çš„ C++ å‡½æ•°éƒ½æ˜¯ä¸é€‚ç”¨çš„â€”â€”ç©ºå€¼å’Œç©ºå¯¹è±¡åªèƒ½ç”¨åœ¨è¿”å›å¼•ç”¨/æŒ‡é’ˆçš„åœºåˆï¼Œä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦å †å†…å­˜åˆ†é…ï¼Œåœ¨ C++ é‡Œä¼šå¼•è‡´é¢å¤–çš„å¼€é”€ã€‚</p><p>C++17 å¼•å…¥çš„ <code>optional</code> æ¨¡æ¿ <span class="orange">[2]</span> å¯ä»¥ï¼ˆéƒ¨åˆ†ï¼‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¯­ä¹‰ä¸Šæ¥è¯´ï¼Œ<code>optional</code> ä»£è¡¨ä¸€ä¸ªâ€œä¹Ÿè®¸æœ‰æ•ˆâ€â€œå¯é€‰â€çš„å¯¹è±¡ã€‚è¯­æ³•ä¸Šæ¥è¯´ï¼Œä¸€ä¸ª <code>optional</code> å¯¹è±¡æœ‰ç‚¹åƒä¸€ä¸ªæŒ‡é’ˆï¼Œä½†å®ƒæ‰€ç®¡ç†çš„å¯¹è±¡æ˜¯ç›´æ¥æ”¾åœ¨ <code>optional</code> é‡Œçš„ï¼Œæ²¡æœ‰é¢å¤–çš„å†…å­˜åˆ†é…ã€‚</p><p>æ„é€ ä¸€ä¸ª <code>optional&lt;T&gt;</code> å¯¹è±¡æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ol>
<li>ä¸ä¼ é€’ä»»ä½•å‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨ç‰¹æ®Šå‚æ•° <code>std::nullopt</code>ï¼ˆå¯ä»¥å’Œ <code>nullptr</code> ç±»æ¯”ï¼‰ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªâ€œç©ºâ€çš„ <code>optional</code> å¯¹è±¡ï¼Œé‡Œé¢ä¸åŒ…å«æœ‰æ•ˆå€¼ã€‚</li>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>std::in_place</code>ï¼Œåé¢è·Ÿæ„é€  <code>T</code> æ‰€éœ€çš„å‚æ•°ï¼Œå¯ä»¥åœ¨ <code>optional</code> å¯¹è±¡ä¸Šç›´æ¥æ„é€ å‡º <code>T</code> çš„æœ‰æ•ˆå€¼ã€‚</li>
<li>å¦‚æœ <code>T</code> ç±»å‹æ”¯æŒæ‹·è´æ„é€ æˆ–è€…ç§»åŠ¨æ„é€ çš„è¯ï¼Œé‚£åœ¨æ„é€  <code>optional&lt;T&gt;</code> æ—¶ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ª <code>T</code> çš„å·¦å€¼æˆ–å³å€¼æ¥å°† <code>T</code> å¯¹è±¡æ‹·è´æˆ–ç§»åŠ¨åˆ° <code>optional</code> ä¸­ã€‚</li>
</ol><!-- [[[read_end]]] --><p>å¯¹äºä¸Šé¢çš„ç¬¬ 1 ç§æƒ…å†µï¼Œ<code>optional</code> å¯¹è±¡é‡Œæ˜¯æ²¡æœ‰å€¼çš„ï¼Œåœ¨å¸ƒå°”å€¼ä¸Šä¸‹æ–‡é‡Œï¼Œä¼šå¾—åˆ° <code>false</code>ï¼ˆç±»ä¼¼äºç©ºæŒ‡é’ˆçš„è¡Œä¸ºï¼‰ã€‚å¯¹äºä¸Šé¢çš„ç¬¬ 2ã€3 ä¸¤ç§æƒ…å†µï¼Œ<code>optional</code> å¯¹è±¡é‡Œæ˜¯æœ‰å€¼çš„ï¼Œåœ¨å¸ƒå°”å€¼ä¸Šä¸‹æ–‡é‡Œï¼Œä¼šå¾—åˆ° <code>true</code>ï¼ˆç±»ä¼¼äºæœ‰æ•ˆæŒ‡é’ˆçš„è¡Œä¸ºï¼‰ã€‚ç±»ä¼¼çš„ï¼Œåœ¨ <code>optional</code> å¯¹è±¡æœ‰å€¼çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç”¨ <code>*</code> å’Œ <code>-&gt;</code> è¿ç®—ç¬¦å»è§£å¼•ç”¨ï¼ˆæ²¡å€¼çš„æƒ…å†µä¸‹ï¼Œç»“æœæ˜¯æœªå®šä¹‰è¡Œä¸ºï¼‰ã€‚</p><p>è™½ç„¶ <code>optional</code> æ˜¯ C++17 æ‰æ ‡å‡†åŒ–çš„ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªç”¨æ³•æ›´æ—©å°±é€šè¡Œäº†ã€‚å› ä¸º <code>optional</code> çš„å®ç°ä¸ç®—å¤æ‚ï¼Œæœ‰äº›åº“é‡Œå°±è‡ªå·±å®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ã€‚æ¯”å¦‚ cpptoml <span class="orange">[3]</span> å°±ç»™å‡ºäº†ä¸‹é¢è¿™æ ·çš„ç¤ºä¾‹ï¼ˆè¿›è¡Œäº†ç¿»è¯‘å’Œé‡æ’ç‰ˆï¼‰ï¼Œç”¨æ³•è·Ÿæ ‡å‡†çš„ <code>optional</code> å®Œå…¨å»åˆï¼š</p><pre><code class="language-c++">auto val = config-&gt;
  get_as&lt;int64_t&gt;("my-int");
// val æ˜¯ cpptoml::option&lt;int64_t&gt;

if (val) {
  // *val æ˜¯ "my-int" é”®ä¸‹çš„æ•´æ•°å€¼
} else {
  // "my-int" ä¸å­˜åœ¨æˆ–ä¸æ˜¯æ•´æ•°
}
</code></pre><p>cpptoml é‡Œåªæ˜¯ä¸ªç¼©å¾®ç‰ˆçš„ <code>optional</code>ï¼Œå®ç°åªæœ‰å‡ åè¡Œï¼Œä¹Ÿä¸æ”¯æŒæˆ‘ä»¬ä¸Šé¢è¯´çš„æ‰€æœ‰æ„é€ æ–¹å¼ã€‚æ ‡å‡†åº“çš„ <code>optional</code> ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ï¼Œé™¤äº†æˆ‘ç›®å‰æè¿°çš„åŠŸèƒ½ï¼Œè¿˜æ”¯æŒä¸‹é¢çš„æ“ä½œï¼š</p><ul>
<li>å®‰å…¨çš„ææ„è¡Œä¸º</li>
<li>æ˜¾å¼çš„ <code>has_value</code> æˆå‘˜å‡½æ•°ï¼Œåˆ¤æ–­ <code>optional</code> æ˜¯å¦æœ‰å€¼</li>
<li><code>value</code> æˆå‘˜å‡½æ•°ï¼Œè¡Œä¸ºç±»ä¼¼äº <code>*</code>ï¼Œä½†åœ¨ <code>optional</code> å¯¹è±¡æ— å€¼æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ <code>std::bad_optional_access</code></li>
<li><code>value_or</code> æˆå‘˜å‡½æ•°ï¼Œåœ¨ <code>optional</code> å¯¹è±¡æ— å€¼æ—¶è¿”å›ä¼ å…¥çš„å‚æ•°</li>
<li><code>swap</code> æˆå‘˜å‡½æ•°ï¼Œå’Œå¦å¤–ä¸€ä¸ª <code>optional</code> å¯¹è±¡è¿›è¡Œäº¤æ¢</li>
<li><code>reset</code> æˆå‘˜å‡½æ•°ï¼Œæ¸…é™¤ <code>optional</code> å¯¹è±¡åŒ…å«çš„å€¼</li>
<li><code>emplace</code> æˆå‘˜å‡½æ•°ï¼Œåœ¨ <code>optional</code> å¯¹è±¡ä¸Šæ„é€ ä¸€ä¸ªæ–°çš„å€¼ï¼ˆä¸ç®¡æˆåŠŸä¸å¦ï¼ŒåŸå€¼ä¼šè¢«ä¸¢å¼ƒï¼‰</li>
<li><code>make_optional</code> å…¨å±€å‡½æ•°ï¼Œäº§ç”Ÿä¸€ä¸ª <code>optional</code> å¯¹è±¡ï¼ˆç±»ä¼¼ <code>make_pair</code>ã€<code>make_unique</code> ç­‰ï¼‰</li>
<li>å…¨å±€æ¯”è¾ƒæ“ä½œ</li>
<li>ç­‰ç­‰</li>
</ul><p>å¦‚æœæˆ‘ä»¬è®¤ä¸ºæ— å€¼å°±æ˜¯æ•°æ®æ— æ•ˆï¼Œåº”å½“è·³è¿‡å‰©ä¸‹çš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸‹é¢è¿™æ ·çš„é«˜é˜¶å‡½æ•°ï¼š</p><pre><code class="language-c++">template &lt;typename T&gt;
constexpr bool has_value(
  const optional&lt;T&gt;&amp; x) noexcept
{
    return x.has_value();
}

template &lt;typename T,
          typename... Args&gt;
constexpr bool has_value(
  const optional&lt;T&gt;&amp; first,
  const optional&lt;
    Args&gt;&amp;... other) noexcept
{
  return first.has_value() &amp;&amp;
         has_value(other...);
}

template &lt;typename F&gt;
auto lift_optional(F&amp;&amp; f)
{
  return [f = forward&lt;F&gt;(f)](
           auto&amp;&amp;... args) {
    typedef decay_t&lt;decltype(f(
      forward&lt;decltype(args)&gt;(args)
        .value()...))&gt;
      result_type;
    if (has_value(args...)) {
      return optional&lt;result_type&gt;(
        f(forward&lt;decltype(args)&gt;(
            args)
            .value()...));
    } else {
      return optional&lt;
        result_type&gt;();
    }
  };
}
</code></pre><p><code>has_value</code> æ¯”è¾ƒç®€å•ï¼Œå®ƒå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª <code>optional</code> å‚æ•°ï¼Œå¹¶åœ¨æ‰€æœ‰å‚æ•°éƒ½æœ‰å€¼æ—¶è¿”å›çœŸï¼Œå¦åˆ™è¿”å›å‡ã€‚<code>lift_optional</code> ç¨å¤æ‚äº›ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚åœ¨è¿”å›çš„å‡½æ•°é‡Œï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª <code>optional</code> ç±»å‹ï¼Œ<code>result_type</code> æ˜¯ç”¨å‚æ•°çš„å€¼ï¼ˆ<code>value()</code>ï¼‰å»è°ƒç”¨åŸå…ˆå‡½æ•°æ—¶çš„è¿”å›å€¼ç±»å‹ï¼Œæœ€åè¿”å›çš„åˆ™æ˜¯ <code>result_type</code> çš„ <code>optional</code> å°è£…ã€‚å‡½æ•°å†…éƒ¨ä¼šæ£€æŸ¥æ‰€æœ‰çš„å‚æ•°æ˜¯å¦éƒ½æœ‰å€¼ï¼ˆé€šè¿‡è°ƒç”¨ <code>has_value</code>ï¼‰ï¼šæœ‰å€¼æ—¶ä¼šå»æ‹¿å‚æ•°çš„å€¼å»è°ƒç”¨åŸå…ˆçš„å‡½æ•°ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„ <code>optional</code> å¯¹è±¡ã€‚</p><p>è¿™ä¸ªå‡½æ•°èƒ½æŠŠä¸€ä¸ªåŸæœ¬è¦æ±‚å‚æ•°å…¨éƒ¨æœ‰æ•ˆçš„å‡½æ•°æŠ¬å‡ï¼ˆliftï¼‰æˆä¸€ä¸ªæ¥å—å’Œè¿”å› <code>optional</code> å‚æ•°çš„å‡½æ•°ï¼Œå¹¶ä¸”ï¼Œåªåœ¨å‚æ•°å…¨éƒ¨æœ‰æ•ˆæ—¶å»è°ƒç”¨åŸæ¥çš„å‡½æ•°ã€‚è¿™æ˜¯ä¸€ç§éå¸¸å‡½æ•°å¼çš„ç¼–ç¨‹æ–¹å¼ã€‚ä½¿ç”¨ä¸Šé¢å‡½æ•°çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-c++">#include &lt;iostream&gt;
#include &lt;functional&gt;
#include &lt;optional&gt;
#include &lt;type_traits&gt;
#include &lt;utility&gt;

using namespace std;

// éœ€åŒ…å« lift_optional çš„å®šä¹‰

constexpr int increase(int n)
{
    return n + 1;
}

// æ ‡å‡†åº“æ²¡æœ‰æä¾› optional çš„è¾“å‡º
ostream&amp;
operator&lt;&lt;(ostream&amp; os,
           optional&lt;int&gt;(x))
{
  if (x) {
    os &lt;&lt; '(' &lt;&lt; *x &lt;&lt; ')';
  } else {
    os &lt;&lt; "(Nothing)";
  }
  return os;
}

int main()
{
  auto inc_opt =
    lift_optional(increase);
  auto plus_opt =
    lift_optional(plus&lt;int&gt;());
  cout &lt;&lt; inc_opt(optional&lt;int&gt;())
       &lt;&lt; endl;
  cout &lt;&lt; inc_opt(make_optional(41))
       &lt;&lt; endl;
  cout &lt;&lt; plus_opt(
            make_optional(41),
            optional&lt;int&gt;())
       &lt;&lt; endl;
  cout &lt;&lt; plus_opt(
            make_optional(41),
            make_optional(1))
       &lt;&lt; endl;
}
</code></pre><p>è¾“å‡ºç»“æœæ˜¯ï¼š</p><blockquote>
<p><code>(Nothing)</code><br>
<code>(42)</code><br>
<code>(Nothing)</code><br>
<code>(42)</code></p>
</blockquote><h2>variant</h2><p><code>optional</code> æ˜¯ä¸€ä¸ªéå¸¸ç®€å•è€Œåˆå¥½ç”¨çš„æ¨¡æ¿ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨å®ƒå°±è¶³å¤Ÿè§£å†³é—®é¢˜äº†ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å…è®¸æœ‰ä¸¤ç§æ•°å€¼çš„å¯¹è±¡ï¼šè¦ä¹ˆæ˜¯ä½ æƒ³æ”¾è¿›å»çš„å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ <code>nullopt</code>ï¼ˆå†æ¬¡æé†’ï¼Œè”æƒ³ <code>nullptr</code>ï¼‰ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›é™¤äº†æˆ‘ä»¬æƒ³æ”¾è¿›å»çš„å¯¹è±¡ï¼Œè¿˜å¯ä»¥æ˜¯ <code>nullopt</code> ä¹‹å¤–çš„å¯¹è±¡æ€ä¹ˆåŠå‘¢ï¼ˆæ¯”å¦‚ï¼ŒæŸç§å‡ºé”™çš„çŠ¶æ€ï¼‰ï¼Ÿåˆæ¯”å¦‚ï¼Œå¦‚æœæˆ‘å¸Œæœ›æœ‰ä¸‰ç§æˆ–æ›´å¤šä¸åŒçš„ç±»å‹å‘¢ï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>variant</code> <span class="orange">[4]</span> å¯èƒ½å°±æ˜¯ä¸€ä¸ªåˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>åœ¨æ²¡æœ‰ <code>variant</code> ç±»å‹ä¹‹å‰ï¼Œä½ è¦è¾¾åˆ°ç±»ä¼¼çš„ç›®çš„ï¼Œææ€•ä¼šä½¿ç”¨ä¸€ç§å«åšå¸¦æ ‡ç­¾çš„è”åˆï¼ˆtagged unionï¼‰çš„æ•°æ®ç»“æ„ã€‚æ¯”å¦‚ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªå¯èƒ½çš„æ•°æ®ç»“æ„å®šä¹‰ï¼š</p><pre><code class="language-c++">struct FloatIntChar {
  enum {
    Float,
    Int,
    Char
  } type;
  union {
    float float_value;
    int int_value;
    char char_value;
  };
};
</code></pre><p>è¿™ä¸ªæ•°æ®ç»“æ„çš„æœ€å¤§é—®é¢˜ï¼Œå°±æ˜¯å®ƒå®é™…ä¸Šæœ‰å¾ˆå¤šå¤æ‚æƒ…å†µéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚å¯¹äºæˆ‘ä»¬ä¸Šé¢ä¾‹å­é‡Œçš„ POD ç±»å‹ï¼Œè¿™ä¹ˆå†™å°±å¯ä»¥äº†ï¼ˆä½†æˆ‘ä»¬ä»éœ€å°å¿ƒä¿è¯æˆ‘ä»¬è®¾ç½®çš„ <code>type</code> å’Œå®é™…ä½¿ç”¨çš„ç±»å‹ä¸€è‡´ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠå…¶ä¸­ä¸€ä¸ªç±»å‹æ¢æˆé POD ç±»å‹ï¼Œå°±ä¼šæœ‰å¤æ‚é—®é¢˜å‡ºç°ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸èƒ½å·¥ä½œçš„ï¼š</p><pre><code class="language-c++">struct StringIntChar {
  enum {
    String,
    Int,
    Char
  } type;
  union {
    string string_value;
    int int_value;
    char char_value;
  };
};
</code></pre><p>ç¼–è¯‘å™¨ä¼šå¾ˆåˆç†åœ°çœ‹åˆ°åœ¨ union é‡Œä½¿ç”¨ <code>string</code> ç±»å‹ä¼šå¸¦æ¥æ„é€ å’Œææ„ä¸Šçš„é—®é¢˜ï¼Œæ‰€ä»¥ä¼šæ‹’ç»å·¥ä½œã€‚è¦è®©è¿™ä¸ªä»£ç å·¥ä½œï¼Œæˆ‘ä»¬å¾—æ‰‹å·¥åŠ ä¸Šææ„å‡½æ•°ï¼Œå¹¶ä¸”ï¼Œåœ¨ææ„å‡½æ•°é‡Œå¾—å°å¿ƒåœ°åˆ¤æ–­å­˜å‚¨çš„æ˜¯ä»€ä¹ˆæ•°å€¼ï¼Œæ¥å†³å®šæ˜¯å¦åº”è¯¥ææ„ï¼ˆå¦åˆ™ï¼Œé»˜è®¤ä¸è°ƒç”¨ä»»ä½• union é‡Œçš„ææ„å‡½æ•°ï¼Œä»è€Œå¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼ï¼‰ï¼š</p><pre><code class="language-c++">  ~StringIntChar()
  {
    if (type == String) {
      string_value.~string();
    }
  }
</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å®‰å…¨åœ°ä½¿ç”¨å®ƒï¼ˆè¿˜æ˜¯å¾ˆéº»çƒ¦ï¼‰ï¼š</p><pre><code class="language-c++">StringIntChar obj{
  .type = StringIntChar::String,
  .string_value = "Hello world"};
cout &lt;&lt; obj.string_value &lt;&lt; endl;
</code></pre><p>è¿™é‡Œç”¨åˆ°äº†æŒ‰æˆå‘˜åˆå§‹åŒ–çš„è¯­æ³•ï¼ŒæŠŠç±»å‹è®¾ç½®æˆäº†å­—ç¬¦ä¸²ï¼ŒåŒæ—¶è®¾ç½®äº†å­—ç¬¦ä¸²çš„å€¼ã€‚ä¸ç”¨è¯´ï¼Œè¿™æ˜¯ä»¶éº»çƒ¦ã€å®¹æ˜“å‡ºé”™çš„äº‹æƒ…ã€‚åŒæ—¶ï¼Œç»†æŸ¥ä¹‹åæˆ‘å‘ç°ï¼Œè¿™ä¸ªè¯­æ³•è™½ç„¶åœ¨ C99 é‡Œæœ‰ï¼Œä½†åœ¨ C++ é‡Œè¦åœ¨ C++20 æ‰ä¼šè¢«æ ‡å‡†åŒ–ï¼Œå› æ­¤å®é™…æ˜¯æœ‰å…¼å®¹æ€§é—®é¢˜çš„â€”â€”è€ç‰ˆæœ¬çš„ MSVCï¼Œæˆ–æœ€æ–°ç‰ˆæœ¬çš„ MSVC åœ¨æ²¡æœ‰å¼€å¯ C++20 æ”¯æŒæ—¶ï¼Œå°±ä¸æ”¯æŒè¿™ä¸ªè¯­æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œç›®å‰çš„ä¸»æµå»ºè®®æ˜¯ï¼Œåº”è¯¥é¿å…ä½¿ç”¨â€œè£¸â€ union äº†ã€‚æ›¿æ¢æ–¹å¼ï¼Œå°±æ˜¯è¿™ä¸€èŠ‚è¦è¯´çš„ <code>variant</code>ã€‚ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœç”¨ <code>variant</code> çš„è¯ï¼Œä¼šéå¸¸çš„å¹²å‡€åˆ©è½ï¼š</p><pre><code class="language-c++">variant&lt;string, int, char&gt; obj{
  "Hello world"};
cout &lt;&lt; get&lt;string&gt;(obj) &lt;&lt; endl;
</code></pre><p>å¯ä»¥æ³¨æ„åˆ°æˆ‘ä¸Šé¢æ„é€ æ—¶ä½¿ç”¨çš„æ˜¯ <code>const char*</code>ï¼Œä½†æ„é€ å‡½æ•°ä»ç„¶èƒ½å¤Ÿæ­£ç¡®åœ°é€‰æ‹© <code>string</code> ç±»å‹ï¼Œè¿™æ˜¯å› ä¸ºæ ‡å‡†è¦æ±‚å®ç°åœ¨æ²¡æœ‰ä¸€ä¸ªå®Œå…¨åŒ¹é…çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©æˆå‘˜ç±»å‹ä¸­èƒ½å¤Ÿä»¥ä¼ å…¥çš„ç±»å‹æ¥æ„é€ çš„é‚£ä¸ªç±»å‹è¿›è¡Œåˆå§‹åŒ–ï¼ˆæœ‰ä¸”åªæœ‰ä¸€ä¸ªæ—¶ï¼‰ã€‚<code>string</code> ç±»å­˜åœ¨å½¢å¼ä¸º <code>string(const char*)</code> çš„æ„é€ å‡½æ•°ï¼ˆä¸ç²¾ç¡®åœ°è¯´ï¼‰ï¼Œæ‰€ä»¥ä¸Šé¢çš„æ„é€ èƒ½å¤Ÿæ­£ç¡®è¿›è¡Œã€‚</p><p>è·Ÿ <code>tuple</code> ç›¸ä¼¼ï¼Œ<code>variant</code> ä¸Šå¯ä»¥ä½¿ç”¨ <code>get</code> å‡½æ•°æ¨¡æ¿ï¼Œå…¶æ¨¡æ¿å‚æ•°å¯ä»¥æ˜¯ä»£è¡¨åºå·çš„æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»å‹ã€‚å¦‚æœç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šåºå·æˆ–ç±»å‹ä¸åˆæ³•ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±ä¼šå‡ºé”™ã€‚å¦‚æœåºå·æˆ–ç±»å‹åˆæ³•ï¼Œä½†è¿è¡Œæ—¶å‘ç° <code>variant</code> é‡Œå­˜å‚¨çš„å¹¶ä¸æ˜¯è¯¥ç±»å¯¹è±¡ï¼Œæˆ‘ä»¬åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ <code>bad_variant_access</code>ã€‚</p><p><code>variant</code> ä¸Šè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æˆå‘˜å‡½æ•°æ˜¯ <code>index</code>ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬èƒ½è·å¾—å½“å‰çš„æ•°å€¼çš„åºå·ã€‚å°±æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­è€Œè¨€ï¼Œ<code>obj.index()</code> å³ä¸º <code>1</code>ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>variant</code> é‡Œæ€»æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å€¼ï¼ˆç¼ºçœä¸ºç¬¬ä¸€ä¸ªç±»å‹çš„é»˜è®¤æ„é€ ç»“æœï¼‰ï¼Œä½†å¦‚æœ <code>emplace</code> ç­‰ä¿®æ”¹æ“ä½œä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œ<code>variant</code> é‡Œä¹Ÿå¯èƒ½æ²¡æœ‰ä»»ä½•æœ‰æ•ˆæ•°å€¼ï¼Œæ­¤æ—¶ <code>index()</code> å°†ä¼šå¾—åˆ° <code>variant_npos</code>ã€‚</p><p>ä»åŸºæœ¬æ¦‚å¿µæ¥è®²ï¼Œ<code>variant</code> å°±æ˜¯ä¸€ä¸ªå®‰å…¨çš„ unionï¼Œç›¸å½“ç®€å•ï¼Œæˆ‘å°±ä¸å¤šåšå…¶ä»–ä»‹ç»äº†ã€‚ä½ å¯ä»¥è‡ªå·±çœ‹æ–‡æ¡£æ¥äº†è§£è¿›ä¸€æ­¥çš„ä¿¡æ¯ã€‚å…¶ä¸­æ¯”è¾ƒæœ‰è¶£çš„ä¸€ä¸ªéæˆå‘˜å‡½æ•°æ˜¯ <code>visit</code> <span class="orange">[5]</span>ï¼Œæ–‡æ¡£é‡Œå±•ç¤ºäº†ä¸€ä¸ªéå¸¸ç®€æ´çš„ã€å¯æ ¹æ®å½“å‰åŒ…å«çš„å˜é‡ç±»å‹è¿›è¡Œå‡½æ•°åˆ†å‘çš„æ–¹æ³•ã€‚</p><p><strong>å¹³å°ç»†èŠ‚ï¼š</strong>åœ¨è€äº Mojave çš„ macOS ä¸Šç¼–è¯‘å«æœ‰ <code>optional</code> æˆ– <code>variant</code> çš„ä»£ç ï¼Œéœ€è¦åœ¨æ–‡ä»¶å¼€å¤´åŠ ä¸Šï¼š</p><pre><code class="language-c++">#if defined(__clang__) &amp;&amp; defined(__APPLE__)
#include &lt;__config&gt;
#undef _LIBCPP_AVAILABILITY_BAD_OPTIONAL_ACCESS
#undef _LIBCPP_AVAILABILITY_BAD_VARIANT_ACCESS
#define _LIBCPP_AVAILABILITY_BAD_OPTIONAL_ACCESS
#define _LIBCPP_AVAILABILITY_BAD_VARIANT_ACCESS
#endif
</code></pre><p>åŸå› æ˜¯è‹¹æœåœ¨å¤´æ–‡ä»¶é‡ŒæŠŠ <code>optional</code> å’Œ <code>variant</code> åœ¨æ—©æœŸç‰ˆæœ¬çš„ macOS ä¸Šç¦æ‰äº†ï¼Œè€Œä¸Šé¢çš„ä»£ç å»æ‰äº†è¿™å‡ ä¸ªå®é‡Œå¯¹ä½¿ç”¨ <code>bad_optional_access</code> å’Œ <code>bad_variant_access</code> çš„å¹³å°é™åˆ¶ã€‚æˆ‘çœŸçœ‹ä¸å‡ºä½¿ç”¨è¿™ä¸¤ä¸ªå¤´æ–‡ä»¶è·Ÿ macOS çš„ç‰ˆæœ¬æœ‰å•¥å…³ç³»ã€‚ğŸ˜</p><h2>expected</h2><p>å’Œå‰é¢ä»‹ç»çš„ä¸¤ä¸ªæ¨¡æ¿ä¸åŒï¼Œ<code>expected</code> ä¸æ˜¯ C++ æ ‡å‡†é‡Œçš„ç±»å‹ã€‚ä½†æ¦‚å¿µä¸Šè¿™ä¸‰è€…æœ‰ç›¸å…³æ€§ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿæ”¾åœ¨ä¸€èµ·è®²ä¸€ä¸‹ã€‚</p><p>æˆ‘å‰é¢å·²ç»æåˆ°ï¼Œ<code>optional</code> å¯ä»¥ä½œä¸ºä¸€ç§ä»£æ›¿å¼‚å¸¸çš„æ–¹å¼ï¼šåœ¨åŸæœ¬è¯¥æŠ›å¼‚å¸¸çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹è€Œè¿”å›ä¸€ä¸ªç©ºçš„ <code>optional</code> å¯¹è±¡ã€‚å½“ç„¶ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±åªçŸ¥é“æ²¡æœ‰è¿”å›ä¸€ä¸ªåˆæ³•çš„å¯¹è±¡ï¼Œè€Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›åˆæ³•å¯¹è±¡äº†ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ”¹ç”¨ä¸€ä¸ª <code>variant</code>ï¼Œä½†æˆ‘ä»¬æ­¤æ—¶éœ€è¦ç»™é”™è¯¯ç±»å‹ä¸€ä¸ªç‹¬ç‰¹çš„ç±»å‹æ‰è¡Œï¼Œå› ä¸ºè¿™æ˜¯ <code>variant</code> æ¨¡æ¿çš„è¦æ±‚ã€‚æ¯”å¦‚ï¼š</p><pre><code class="language-c++">enum class error_code {
  success,
  operation_failure,
  object_not_found,
  â€¦
};

variant&lt;Obj, error_code&gt;
  get_object(â€¦);
</code></pre><p>è¿™å½“ç„¶æ˜¯ä¸€ç§å¯è¡Œçš„é”™è¯¯å¤„ç†æ–¹å¼ï¼šæˆ‘ä»¬å¯ä»¥åˆ¤æ–­è¿”å›å€¼çš„ <code>index()</code>ï¼Œæ¥å†³å®šæ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ã€‚ä½†è¿™ç§æ–¹å¼ä¸é‚£ä¹ˆç›´æˆªäº†å½“ï¼Œä¹Ÿè¦æ±‚å®ç°å¯¹å…è®¸çš„é”™è¯¯ç±»å‹ä½œå‡ºè§„å®šã€‚Andrei Alexandrescu åœ¨ 2012 å¹´é¦–å…ˆæå‡ºçš„ Expected æ¨¡æ¿ <span class="orange">[6]</span>ï¼Œæä¾›äº†å¦å¤–ä¸€ç§é”™è¯¯å¤„ç†æ–¹å¼ã€‚ä»–çš„æ–¹æ³•çš„è¦ç‚¹åœ¨äºï¼ŒæŠŠå®Œæ•´çš„å¼‚å¸¸ä¿¡æ¯æ”¾åœ¨è¿”å›å€¼ï¼Œå¹¶åœ¨å¿…è¦çš„æ—¶å€™ï¼Œå¯ä»¥â€œé‡æ”¾â€å‡ºæ¥ï¼Œæˆ–è€…æ‰‹å·¥æ£€æŸ¥æ˜¯ä¸æ˜¯æŸç§ç±»å‹çš„å¼‚å¸¸ã€‚</p><p>ä»–çš„æ¦‚å¿µå¹¶æ²¡æœ‰è¢«å¹¿æ³›æ¨å¹¿ï¼Œæœ€ä¸»è¦çš„åŸå› å¯èƒ½æ˜¯æ€§èƒ½ã€‚å¼‚å¸¸æœ€è¢«äººè¯Ÿç—…çš„åœ°æ–¹æ˜¯æ€§èƒ½ï¼Œè€Œä»–çš„æ–¹å¼å¯¹æ€§èƒ½å®Œå…¨æ²¡æœ‰å¸®åŠ©ã€‚ä¸è¿‡ï¼Œåé¢çš„ç±»ä¼¼æ¨¡æ¿éƒ½æ±²å–äº†ä»–çš„éƒ¨åˆ†æ€æƒ³ï¼Œè‡³å°‘ä¼šç”¨ä¸€ç§æ˜¾å¼çš„æ–¹å¼æ¥æ˜ç¡®è¯´æ˜å½“å‰æ˜¯å¼‚å¸¸æƒ…å†µè¿˜æ˜¯æ­£å¸¸æƒ…å†µã€‚åœ¨ç›®å‰çš„ expected çš„æ ‡å‡†ææ¡ˆ <span class="orange">[7]</span> é‡Œï¼Œç”¨æ³•æœ‰ç‚¹æ˜¯ <code>optional</code> å’Œ <code>variant</code> çš„æŸç§æ··åˆï¼šæ¨¡æ¿çš„å£°æ˜å½¢å¼åƒ <code>variant</code>ï¼Œä½¿ç”¨æ­£å¸¸è¿”å›å€¼åƒ <code>optional</code>ã€‚</p><p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ª expected å®ç° <span class="orange">[8]</span> çš„åŸºæœ¬ç”¨æ³•ã€‚</p><pre><code class="language-c++">#include &lt;cstdint&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;tl/expected.hpp&gt;

using namespace std;
using tl::expected;
using tl::unexpected;

// è¿”å› expected çš„å®‰å…¨é™¤æ³•
expected&lt;int, string&gt;
safe_divide(int i, int j)
{
  if (j == 0)
    return unexpected(
      "divide by zero"s);
  if (i == INT_MIN &amp;&amp; j == -1)
    return unexpected(
      "integer divide overflows"s);
  if (i % j != 0)
    return unexpected(
      "not integer division"s);
  else
    return i / j;
}

// ä¸€ä¸ªæµ‹è¯•å‡½æ•°
expected&lt;int, string&gt;
caller(int i, int j, int k)
{
  auto q = safe_divide(j, k);
  if (q)
    return i + *q;
  else
    return q;
}

// æ”¯æŒ expected çš„è¾“å‡ºå‡½æ•°
template &lt;typename T, typename E&gt;
ostream&amp; operator&lt;&lt;(
  ostream&amp; os,
  const expected&lt;T, E&gt;&amp; exp)
{
  if (exp) {
    os &lt;&lt; exp.value();
  } else {
    os &lt;&lt; "unexpected: "
       &lt;&lt; exp.error();
  }
  return os;
}

// è°ƒè¯•ä½¿ç”¨çš„æ£€æŸ¥å®
#define CHECK(expr)               \
  {                               \
    auto result = (expr);         \
    cout &lt;&lt; result;               \
    if (result ==                 \
        unexpected(               \
          "divide by zero"s)) {   \
      cout                        \
        &lt;&lt; ": Are you serious?";  \
    } else if (result == 42) {    \
      cout &lt;&lt; ": Ha, I got you!"; \
    }                             \
    cout &lt;&lt; endl;                 \
  }

int main()
{
  CHECK(caller(2, 1, 0));
  CHECK(caller(37, 20, 7));
  CHECK(caller(39, 21, 7));
}
</code></pre><p>è¾“å‡ºæ˜¯ï¼š</p><blockquote>
<p><code>unexpected: divide by zero: Are you serious?</code><br>
<code>unexpected: not integer division</code><br>
<code>42: Ha, I got you!</code></p>
</blockquote><p>ä¸€ä¸ª <code>expected&lt;T, E&gt;</code> å·®ä¸å¤šå¯ä»¥çœ‹ä½œæ˜¯ <code>T</code> å’Œ <code>unexpected&lt;E&gt;</code> çš„ <code>variant</code>ã€‚åœ¨å­¦è¿‡ä¸Šé¢çš„ <code>variant</code> ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å¾ˆå®¹æ˜“çœ‹æ˜ç™½ä¸Šé¢çš„ç¨‹åºäº†ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªéœ€è¦æ³¨æ„ä¸€ä¸‹çš„åœ°æ–¹ï¼š</p><ul>
<li>å¦‚æœä¸€ä¸ªå‡½æ•°è¦æ­£å¸¸è¿”å›æ•°æ®ï¼Œä»£ç æ— éœ€ä»»ä½•ç‰¹æ®Šå†™æ³•ï¼›å¦‚æœå®ƒè¦è¡¨ç¤ºå‡ºç°äº†å¼‚å¸¸ï¼Œåˆ™å¯ä»¥è¿”å›ä¸€ä¸ª <code>unexpected</code> å¯¹è±¡ã€‚</li>
<li>è¿™ä¸ªè¿”å›å€¼å¯ä»¥ç”¨æ¥å’Œä¸€ä¸ªæ­£å¸¸å€¼æˆ– unexpected å¯¹è±¡æ¯”è¾ƒï¼Œå¯ä»¥åœ¨å¸ƒå°”å€¼ä¸Šä¸‹æ–‡é‡Œæ£€æŸ¥æ˜¯å¦æœ‰æ­£å¸¸å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>*</code> è¿ç®—ç¬¦æ¥å–å¾—å…¶ä¸­çš„æ­£å¸¸å€¼â€”â€”ä¸ <code>optional</code> ç±»ä¼¼ï¼Œåœ¨æ²¡æœ‰æ­£å¸¸å€¼çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>*</code> æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚</li>
<li>å¯ä»¥ç”¨ <code>value</code> æˆå‘˜å‡½æ•°æ¥å–å¾—å…¶ä¸­çš„æ­£å¸¸å€¼ï¼Œæˆ–ä½¿ç”¨ <code>error</code> æˆå‘˜å‡½æ•°æ¥å–å¾—å…¶ä¸­çš„é”™è¯¯å€¼â€”â€”ä¸ <code>variant</code> ç±»ä¼¼ï¼Œåœ¨ <code>expected</code> ä¸­æ²¡æœ‰å¯¹åº”çš„å€¼æ—¶äº§ç”Ÿå¼‚å¸¸ <code>bad_expected_access</code>ã€‚</li>
<li>è¿”å›é”™è¯¯è·ŸæŠ›å‡ºå¼‚å¸¸æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ£€æŸ¥æ˜¯å¦å‘ç”Ÿé”™è¯¯çš„ä»£ç è¿˜æ˜¯è¦æ¯”å¼‚å¸¸å¤„ç†å•°å—¦ã€‚</li>
</ul><h2>Herbception</h2><p>ä¸Šé¢çš„ç”¨æ³•åˆçœ‹è¿˜è¡Œï¼Œä½†çœŸæ­£ç”¨èµ·æ¥ï¼Œä½ ä¼šå‘ç°ä»ç„¶æ²¡æœ‰ä½¿ç”¨å¼‚å¸¸æ–¹ä¾¿ã€‚è¿™åªæ˜¯ä¸ºäº†è§£å†³å¼‚å¸¸åœ¨é”™è¯¯å¤„ç†æ€§èƒ½é—®é¢˜ä¸Šçš„æ— å¥ˆä¹‹ä¸¾ã€‚å¤§éƒ¨åˆ†è¯•å›¾æ›¿æ¢ C++ å¼‚å¸¸çš„æ–¹æ³•éƒ½æ˜¯ç‰ºç‰²ç¼–ç¨‹æ–¹ä¾¿æ€§ï¼Œæ¥æ¢å–æ€§èƒ½ã€‚åªæœ‰ Herb Sutter æå‡ºäº†ä¸€ä¸ªåŸºæœ¬å…¼å®¹å½“å‰ C++ å¼‚å¸¸å¤„ç†æ–¹å¼çš„é”™è¯¯å¤„ç†æ–¹å¼ <span class="orange">[9]</span>ï¼Œè¢«æˆç§°ä¸º Herbceptionã€‚</p><p>ä¸Šé¢ä½¿ç”¨ expected çš„ç¤ºä¾‹ä»£ç ï¼Œå¦‚æœæ”¹ç”¨ Herbception çš„è¯ï¼Œå¯ä»¥å¤§è‡´å¦‚ä¸‹æ”¹é€ ï¼ˆç¤ºæ„ï¼Œå°šæ— æ³•ç¼–è¯‘ï¼‰ï¼š</p><pre><code class="language-c++">int safe_divide(int i, int j) throws
{
  if (j == 0)
    throw arithmetic_errc::
      divide_by_zero;
  if (i == INT_MIN &amp;&amp; j == -1)
    throw arithmetic_errc::
      integer_divide_overflows;
  if (i % j != 0)
    throw arithmetic_errc::
      not_integer_division;
  else
    return i / j;
}

int caller(int i, int j,
           int k) throws
{
  return i + safe_divide(j, k);
}

#define CHECK(expr)               \
  try {                           \
    int result = (expr);          \
    cout &lt;&lt; result;               \
    if (result == 42) {           \
      cout &lt;&lt; ": Ha, I got you!"; \
    }                             \
  }                               \
  catch (error e) {               \
    if (e == arithmetic_errc::    \
               divide_by_zero) {  \
      cout                        \
        &lt;&lt; "Are you serious? ";   \
    }                             \
    cout &lt;&lt; "An error occurred";  \
  }                               \
  cout &lt;&lt; endl

int main()
{
  CHECK(caller(2, 1, 0));
  CHECK(caller(37, 20, 7));
  CHECK(caller(39, 21, 7));
}
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç å’Œæ™®é€šä½¿ç”¨å¼‚å¸¸çš„ä»£ç éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul>
<li>å‡½æ•°éœ€è¦ä½¿ç”¨ <code>throws</code>ï¼ˆæ³¨æ„ä¸æ˜¯ <code>throw</code>ï¼‰è¿›è¡Œå£°æ˜ã€‚</li>
<li>æŠ›å‡ºå¼‚å¸¸çš„è¯­æ³•å’Œä¸€èˆ¬å¼‚å¸¸è¯­æ³•ç›¸åŒï¼Œä½†æŠ›å‡ºçš„æ˜¯ä¸€ä¸ª <code>std::error</code> å€¼ <span class="orange">[10]</span>ã€‚</li>
<li>æ•æ‰å¼‚å¸¸æ—¶ä¸éœ€è¦ä½¿ç”¨å¼•ç”¨ï¼ˆå› ä¸º <code>std::error</code> æ˜¯ä¸ªâ€œå°â€å¯¹è±¡ï¼‰ï¼Œä¸”ä½¿ç”¨ä¸€èˆ¬çš„æ¯”è¾ƒæ“ä½œæ¥æ£€æŸ¥å¼‚å¸¸â€œç±»å‹â€ï¼Œä¸å†ä½¿ç”¨å¼€é”€å¤§çš„ RTTIã€‚</li>
</ul><p>è™½ç„¶è¯­æ³•ä¸ŠåŸºæœ¬æ˜¯ä½¿ç”¨å¼‚å¸¸çš„æ ·å­ï¼Œä½† Herb çš„æ–¹æ¡ˆå´æ²¡æœ‰å¼‚å¸¸çš„ä¸ç¡®å®šå¼€é”€ï¼Œæ€§èƒ½å’Œä½¿ç”¨ expected ç›¸ä»¿ã€‚ä»–ç‰ºç‰²äº†å¼‚å¸¸ç±»å‹çš„ä¸°å¯Œï¼Œä½†ä»å®é™…ç¼–ç¨‹ç»éªŒæ¥çœ‹ï¼Œè¶Šæ˜¯ä½“ç°å‡ºå¼‚å¸¸ä¼˜è¶Šæ€§çš„åœ°æ–¹â€”â€”å¼‚å¸¸å¤„ç†ç‚¹å’Œå¼‚å¸¸å‘ç”Ÿç‚¹è·ç¦»è¾ƒè¿œçš„æ—¶å€™â€”â€”è¶Šä¸éœ€è¦å¼‚å¸¸æœ‰ä¸°å¯Œçš„ç±»å‹ã€‚å› æ­¤ï¼Œæ€»ä½“ä¸Šçœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¸å¼•äººçš„æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œç”±äºææ¡ˆæ—¶é—´è¾ƒæ™šï¼Œäº‰è®®é¢‡å¤šï¼Œè¿™ä¸ªæ–¹æ¡ˆè¦è¿›å…¥æ ‡å‡†è‡³å°‘è¦ C++23 äº†ã€‚æˆ‘ä»¬ç›®å‰ç¨ç¨äº†è§£ä¸€ä¸‹å°±è¡Œã€‚</p><p>æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹å‚è€ƒèµ„æ–™ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬è®²æˆ‘ä»¬è®¨è®ºäº†ä¸¤ä¸ª C++ æ ‡å‡†åº“çš„æ¨¡æ¿ <code>optional</code> å’Œ <code>variant</code>ï¼Œç„¶åè®¨è®ºäº†ä¸¤ä¸ªæ ‡å‡†ææ¡ˆ expected å’Œ Herbceptionã€‚è¿™äº›ç»“æ„éƒ½å¯ä»¥ä½¿ç”¨åœ¨é”™è¯¯å¤„ç†è¿‡ç¨‹ä¸­â€”â€”å‰ä¸‰è€…å½“å‰å¯ç”¨ï¼Œä½†å’Œå¼‚å¸¸ç›¸æ¯”æœ‰ä¸åŒçš„å–èˆï¼›Herbception å½“å‰è¿˜ä¸å¯ç”¨ï¼Œä½†æœ‰å¸Œæœ›åœ¨é”™è¯¯å¤„ç†ä¸Šè¾¾åˆ°æœ€ä½³çš„æƒè¡¡ç‚¹ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>é”™è¯¯å¤„ç†æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„é—®é¢˜ï¼Œåœ¨ C++ è¯ç”Ÿä¹‹åè¿™ä¹ˆå¤šå¹´ä»ç„¶æ²¡æœ‰è¯¥å¦‚ä½•å¤„ç†çš„å®šè®ºã€‚å¦‚ä½•å¯¹æ˜“ç”¨æ€§å’Œæ€§èƒ½è¿›è¡Œå–èˆï¼Œä¸€ç›´æ˜¯ä¸€ä¸ªæœ‰çŸ›ç›¾çš„è€å¤§éš¾é—®é¢˜ã€‚ä½ çš„å®é™…é¡¹ç›®ä¸­æ˜¯å¦‚ä½•é€‰æ‹©çš„ï¼Ÿä½ è§‰å¾—åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„çœ‹æ³•ã€‚</p><h2><span class="reference">å‚è€ƒèµ„æ–™</span></h2><p><span class="reference">[1] Wikipedia, â€œNull object patternâ€. <a href="https://en.wikipedia.org/wiki/Null_object_pattern">https://en.wikipedia.org/wiki/Null_object_pattern</a> </span></p><p><span class="reference">[2] cppreference.com, â€œstd::optionalâ€. <a href="https://en.cppreference.com/w/cpp/utility/optional">https://en.cppreference.com/w/cpp/utility/optional</a> </span></p><p><span class="reference">[2a] cppreference.com, â€œstd::optionalâ€. <a href="https://zh.cppreference.com/w/cpp/utility/optional">https://zh.cppreference.com/w/cpp/utility/optional</a> </span></p><p><span class="reference">[3] Chase Geigle, cpptoml. <a href="https://github.com/skystrife/cpptoml">https://github.com/skystrife/cpptoml</a> </span></p><p><span class="reference">[4] cppreference.com, â€œstd::optionalâ€. <a href="https://en.cppreference.com/w/cpp/utility/variant">https://en.cppreference.com/w/cpp/utility/variant</a> </span></p><p><span class="reference">[4a] cppreference.com, â€œstd::optionalâ€. <a href="https://zh.cppreference.com/w/cpp/utility/variant">https://zh.cppreference.com/w/cpp/utility/variant</a> </span></p><p><span class="reference">[5] cppreference.com, â€œstd::visitâ€. <a href="https://en.cppreference.com/w/cpp/utility/variant/visit">https://en.cppreference.com/w/cpp/utility/variant/visit</a> </span></p><p><span class="reference">[5a] cppreference.com, â€œstd::visitâ€. <a href="https://zh.cppreference.com/w/cpp/utility/variant/visit">https://zh.cppreference.com/w/cpp/utility/variant/visit</a> </span></p><p><span class="reference">[6] Andrei Alexandrescu, â€œSystematic error handling in C++â€. <a href="https://channel9.msdn.com/Shows/Going+Deep/C-and-Beyond-2012-Andrei-Alexandrescu-Systematic-Error-Handling-in-C">https://channel9.msdn.com/Shows/Going+Deep/C-and-Beyond-2012-Andrei-Alexandrescu-Systematic-Error-Handling-in-C</a> </span></p><p><span class="reference">[7] Vicente J. Botet EscribÃ¡ and JF Bastien, â€œUtility class to represent expected objectâ€. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/p0323r3.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/p0323r3.pdf</a> </span></p><p><span class="reference">[8] Simon Brand, expected. <a href="https://github.com/TartanLlama/expected">https://github.com/TartanLlama/expected</a> </span></p><p><span class="reference">[9] Herb Sutter, â€œP0709R0: Zero-overhead deterministic exceptions: Throwing valuesâ€. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0709r0.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0709r0.pdf</a> </span></p><p><span class="reference">[10] Niall Douglas, â€œP1028R0: SG14 <code>status_code</code> and standard <code>error object</code> for P0709 Zero-overhead deterministic exceptionsâ€. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1028r0.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1028r0.pdf</a> </span></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            å»–ç†ŠçŒ«  2020-01-15 09:51:47
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            æœ‰çš„è¯­è¨€é‡Œé¢æ²¡æœ‰try catchï¼Œç»Ÿä¸€ä½¿ç”¨ç±»ä¼¼optionalçš„ç»“å±€æ–¹æ¡ˆï¼Œæ¯”å¦‚Rusté‡Œé¢çš„Errï¼ŒHaskellä¸­å¯¹åº”çš„åº”è¯¥æ˜¯Eitherç±»å‹ï¼Œè¿™äº›éƒ½æ˜¯å¤„ç†å¯ä»¥æ¢å¤çš„é”™è¯¯ï¼Œä¸å¯æ¢å¤çš„ç›´æ¥å°±è®©ç¨‹åºå´©äº†ã€‚<br>lift_optionalè®©æˆ‘æƒ³èµ·æ¥è¢«Haskellæ”¯é…çš„ææƒ§ (Just (+) ) &lt;*&gt;  Just 41 &lt;*&gt; Just 1<br>ä¸çŸ¥é“è€å¸ˆåé¢ä¼šä¸ä¼šè®²åˆ°monadğŸ˜‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2020-01-15 17:42:39</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">optional å¯¹åº”çš„æ˜¯ Maybe å§ã€‚expected æ¯”è¾ƒåƒ Eitherã€‚<br><br>ä¸ä¼šè®² monadã€‚è¿™ä¸ªå³ä½¿ä¸“é—¨è®²å‡½æ•°å¼ç¼–ç¨‹ä¹Ÿè¦æ¯”è¾ƒåé¢å‘¢ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            tt  2020-01-15 08:24:46
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            è€å¸ˆï¼Œå¬äº†æ‚¨çš„è¯¾åï¼Œè§‰å¾—ç°åœ¨C++æ ‡å‡†ææ¡ˆæœ‰å¾ˆå¤šéƒ½æ˜¯åˆ©ç”¨C++çš„è¯­ä¹‰å’Œè¯­æ³•æ¥å†™æå‡ç¼–ç¨‹ä¾¿åˆ©æ€§çš„æ¨¡æ¿ï¼Œæ˜¯è¿™æ ·ä¹ˆï¼Ÿ<br><br>è¿˜æœ‰ï¼Œä¸€ç›´ä¸çŸ¥é“C++çš„å¼‚å¸¸æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¿˜æœ‰è¿™é‡Œè¯´çš„å¼‚å¸¸å¤„ç†çš„æ€§èƒ½é—®é¢˜ï¼Œæœ‰æ¨èçš„æ¯”è¾ƒå¥½é˜…è¯»çš„å‚è€ƒæ–‡çŒ®ä¹ˆï¼Ÿ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;        line-height:1.2">ä½œè€…å›å¤2020-01-15 22:38:09</div>
    <div style="color:#353535;font-weight:400;white-space:normal;        word-break:break-all;line-height:1.6">æ˜¯çš„ã€‚æé«˜å¼€å‘çš„å‹å¥½ç¨‹åº¦ï¼Œå°¤å…¶æ˜¯å¯¹æ–°æ‰‹çš„å‹å¥½ç¨‹åº¦ï¼Œä¸€ç›´æ˜¯ C++ å§”å‘˜ä¼šçš„ç›®æ ‡ã€‚ä½ åº”è¯¥å‘ç°è™½ç„¶è¯­è¨€è¶Šæ¥è¶Šå¤æ‚ï¼Œä½†å¾ˆå¤šä¸œè¥¿ç¼ºè¶Šæ¥è¶Šå¥½å†™äº†ã€‚<br><br>å¼‚å¸¸çš„å®ç°éå¸¸å¤æ‚ã€‚æƒ³äº†è§£çš„è¯éœ€è¦èŠ±ç‚¹åŠ›æ°”ã€‚ä¸è¿‡æˆ‘å€’æ˜¯æŸ¥åˆ°æœ‰ç¯‡è¿˜ä¸é”™çš„ä¸­æ–‡æ–‡ç« ï¼Œæ¨èä¸€çœ‹ï¼š<br><br>http:&#47;&#47;baiy.cn&#47;doc&#47;cpp&#47;inside_exception.htm</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>