<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>08-æ˜“ç”¨æ€§æ”¹è¿›Iï¼šè‡ªåŠ¨ç±»å‹æ¨æ–­å’Œåˆå§‹åŒ–</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>08-æ˜“ç”¨æ€§æ”¹è¿›Iï¼šè‡ªåŠ¨ç±»å‹æ¨æ–­å’Œåˆå§‹åŒ–</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>åœ¨ä¹‹å‰çš„å‡ è®²é‡Œï¼Œæˆ‘ä»¬å·²ç»å¤šå¤šå°‘å°‘æ¥è§¦åˆ°äº†ä¸€äº› C++11 ä»¥æ¥å¢åŠ çš„æ–°ç‰¹æ€§ã€‚ä¸‹é¢çš„ä¸¤è®²ï¼Œæˆ‘ä¼šé‡ç‚¹è®²ä¸€ä¸‹ç°ä»£ C++ï¼ˆC++11/14/17ï¼‰å¸¦æ¥çš„æ˜“ç”¨æ€§æ”¹è¿›ã€‚</p><p>å°±åƒæˆ‘ä»¬ <a href="https://time.geekbang.org/column/article/169177">[å¼€ç¯‡è¯]</a> ä¸­è¯´çš„ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯ä»‹ç» C++ é‡Œå¥½ç”¨çš„ç‰¹æ€§ï¼Œè€Œéè®©ä½ æ­»è®°è§„åˆ™ã€‚å› æ­¤ï¼Œè¿™é‡Œè®²åˆ°çš„å†…å®¹ï¼Œæœ‰æ—¶æ˜¯ä¸€ç§ç®€åŒ–çš„è¯´æ³•ã€‚å¯¹äºæ—¥å¸¸ä½¿ç”¨ï¼Œæœ¬è®²ä»‹ç»çš„åº”è¯¥èƒ½æ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚å¯¹äºå¤æ‚ç”¨æ³•å’Œè¾¹è§’æƒ…å†µï¼Œä½ å¯èƒ½è¿˜æ˜¯éœ€è¦æŸ¥é˜…å‚è€ƒèµ„æ–™é‡Œçš„æ˜ç»†è§„åˆ™ã€‚</p><h2>è‡ªåŠ¨ç±»å‹æ¨æ–­</h2><p>å¦‚æœè¦æŒ‘é€‰ C++11 å¸¦æ¥çš„æœ€é‡å¤§æ”¹å˜çš„è¯ï¼Œè‡ªåŠ¨ç±»å‹æ¨æ–­è‚¯å®šæ’åå‰ä¸‰ã€‚å¦‚æœåªçœ‹æ˜“ç”¨æ€§æˆ–è¡¨è¾¾èƒ½åŠ›çš„æ”¹è¿›çš„è¯ï¼Œé‚£å®ƒå°±æ˜¯â€œèˆæˆ‘å…¶è°â€çš„ç¬¬ä¸€äº†ã€‚</p><h3>auto</h3><p>è‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®è¡¨è¾¾å¼çš„ç±»å‹ï¼Œè‡ªåŠ¨å†³å®šå˜é‡çš„ç±»å‹ï¼ˆä» C++14 å¼€å§‹ï¼Œè¿˜æœ‰å‡½æ•°çš„è¿”å›ç±»å‹ï¼‰ï¼Œä¸å†éœ€è¦ç¨‹åºå‘˜æ‰‹å·¥å£°æ˜ï¼ˆ<span class="orange">[1]</span>ï¼‰ã€‚ä½†éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<code>auto</code> å¹¶æ²¡æœ‰æ”¹å˜ C++ æ˜¯é™æ€ç±»å‹è¯­è¨€è¿™ä¸€äº‹å®â€”â€”ä½¿ç”¨ <code>auto</code> çš„å˜é‡ï¼ˆæˆ–å‡½æ•°è¿”å›å€¼ï¼‰çš„ç±»å‹ä»ç„¶æ˜¯ç¼–è¯‘æ—¶å°±ç¡®å®šäº†ï¼Œåªä¸è¿‡ç¼–è¯‘å™¨èƒ½è‡ªåŠ¨å¸®ä½ å¡«å……è€Œå·²ã€‚</p><p>è‡ªåŠ¨ç±»å‹æ¨æ–­ä½¿å¾—åƒä¸‹é¢è¿™æ ·ç´¯èµ˜çš„è¡¨è¾¾å¼æˆä¸ºå†å²ï¼š</p><pre><code class="language-c++">// vector&lt;int&gt; v;
for (vector&lt;int&gt;::iterator
       it = v.begin(),
       end = v.end();
     it != end; ++it) {
  // å¾ªç¯ä½“
}
</code></pre><!-- [[[read_end]]] --><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ï¼ˆå½“ç„¶ï¼Œæ˜¯ä¸ä½¿ç”¨åŸºäºèŒƒå›´çš„ for å¾ªç¯çš„æƒ…å†µï¼‰ï¼š</p><pre><code class="language-c++">for (auto it = v.begin(), end = v.end();
     it != end; ++it) {
  // å¾ªç¯ä½“
}
</code></pre><p>ä¸ä½¿ç”¨è‡ªåŠ¨ç±»å‹æ¨æ–­æ—¶ï¼Œå¦‚æœå®¹å™¨ç±»å‹æœªçŸ¥çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŠ ä¸Š <code>typename</code>ï¼ˆæ³¨æ„æ­¤å¤„ const å¼•ç”¨è¿˜è¦æ±‚æˆ‘ä»¬å†™ <code>const_iterator</code> ä½œä¸ºè¿­ä»£å™¨çš„ç±»å‹ï¼‰ï¼š</p><pre><code class="language-c++">template &lt;typename T&gt;
void foo(const T&amp; container)
{
  for (typename T::const_iterator
         it = v.begin(),
    â€¦
}
</code></pre><p>å¦‚æœ <code>begin</code> è¿”å›çš„ç±»å‹ä¸æ˜¯è¯¥ç±»å‹çš„ <code>const_iterator</code> åµŒå¥—ç±»å‹çš„è¯ï¼Œé‚£å®é™…ä¸Šä¸ç”¨è‡ªåŠ¨ç±»å‹æ¨æ–­å°±æ²¡æ³•è¡¨è¾¾äº†ã€‚è¿™è¿˜çœŸä¸æ˜¯å‡è®¾ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„éå†å‡½æ•°è¦æ±‚æ”¯æŒ C æ•°ç»„çš„è¯ï¼Œä¸ç”¨è‡ªåŠ¨ç±»å‹æ¨æ–­çš„è¯ï¼Œå°±åªèƒ½ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„é‡è½½ï¼š</p><pre><code class="language-c++">template &lt;typename T, std::size_t N&gt;
void foo(const T (&amp;a)[N])
{
  typedef const T* ptr_t;
  for (ptr_t it = a, end = a + N;
       it != end; ++it) {
    // å¾ªç¯ä½“
  }
}

template &lt;typename T&gt;
void foo(const T&amp; c)
{
  for (typename T::const_iterator
         it = c.begin(),
         end = c.end();
       it != end; ++it) {
    // å¾ªç¯ä½“
  }
}
</code></pre><p>å¦‚æœä½¿ç”¨è‡ªåŠ¨ç±»å‹æ¨æ–­çš„è¯ï¼Œå†åŠ ä¸Š C++11 æä¾›çš„å…¨å±€ <code>begin</code> å’Œ <code>end</code> å‡½æ•°ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥ç»Ÿä¸€æˆï¼š</p><pre><code class="language-c++">template &lt;typename T&gt;
void foo(const T&amp; c)
{
  using std::begin;
  using std::end;
  // ä½¿ç”¨ä¾èµ–å‚æ•°æŸ¥æ‰¾ï¼ˆADLï¼‰ï¼›è§ <span class="orange">[2]</span>
  for (auto it = begin(c),
       ite = end(c);
       it != ite; ++it) {
    // å¾ªç¯ä½“
  }
}
</code></pre><p>ä»è¿™ä¸ªä¾‹å­å¯è§ï¼Œè‡ªåŠ¨ç±»å‹æ¨æ–­ä¸ä»…é™ä½äº†ä»£ç çš„å•°å—¦ç¨‹åº¦ï¼Œä¹Ÿæé«˜äº†ä»£ç çš„æŠ½è±¡æ€§ï¼Œä½¿æˆ‘ä»¬å¯ä»¥ç”¨æ›´å°‘çš„ä»£ç å†™å‡ºé€šç”¨çš„åŠŸèƒ½ã€‚</p><p><code>auto</code> å®é™…ä½¿ç”¨çš„è§„åˆ™ç±»ä¼¼äºå‡½æ•°æ¨¡æ¿å‚æ•°çš„æ¨å¯¼è§„åˆ™ï¼ˆ<span class="orange">[3]</span>ï¼‰ã€‚å½“ä½ å†™äº†ä¸€ä¸ªå« <code>auto</code> çš„è¡¨è¾¾å¼æ—¶ï¼Œç›¸å½“äºæŠŠ <code>auto</code> æ›¿æ¢ä¸ºæ¨¡æ¿å‚æ•°çš„ç»“æœã€‚ä¸¾å…·ä½“çš„ä¾‹å­ï¼š</p><ul>
<li><code>auto a = expr;</code> æ„å‘³ç€ç”¨ <code>expr</code> å»åŒ¹é…ä¸€ä¸ªå‡æƒ³çš„ <code>template &lt;typename T&gt; f(T)</code> å‡½æ•°æ¨¡æ¿ï¼Œç»“æœä¸ºå€¼ç±»å‹ã€‚</li>
<li><code>const auto&amp; a = expr;</code> æ„å‘³ç€ç”¨ <code>expr</code> å»åŒ¹é…ä¸€ä¸ªå‡æƒ³çš„ <code>template &lt;typename T&gt; f(const T&amp;)</code> å‡½æ•°æ¨¡æ¿ï¼Œç»“æœä¸ºå¸¸å·¦å€¼å¼•ç”¨ç±»å‹ã€‚</li>
<li><code>auto&amp;&amp; a = expr;</code> æ„å‘³ç€ç”¨ <code>expr</code> å»åŒ¹é…ä¸€ä¸ªå‡æƒ³çš„ <code>template &lt;typename T&gt; f(T&amp;&amp;)</code> å‡½æ•°æ¨¡æ¿ï¼Œæ ¹æ® <a href="https://time.geekbang.org/column/article/169268">[ç¬¬ 3 è®²]</a> ä¸­æˆ‘ä»¬è®¨è®ºè¿‡çš„è½¬å‘å¼•ç”¨å’Œå¼•ç”¨åç¼©è§„åˆ™ï¼Œç»“æœæ˜¯ä¸€ä¸ªè·Ÿ <code>expr</code> å€¼ç±»åˆ«ç›¸åŒçš„å¼•ç”¨ç±»å‹ã€‚</li>
</ul><h3>decltype</h3><p><code>decltype</code> çš„ç”¨é€”æ˜¯è·å¾—ä¸€ä¸ªè¡¨è¾¾å¼çš„ç±»å‹ï¼Œç»“æœå¯ä»¥è·Ÿç±»å‹ä¸€æ ·ä½¿ç”¨ã€‚å®ƒæœ‰ä¸¤ä¸ªåŸºæœ¬ç”¨æ³•ï¼š</p><ul>
<li><code>decltype(å˜é‡å)</code> å¯ä»¥è·å¾—å˜é‡çš„ç²¾ç¡®ç±»å‹ã€‚</li>
<li><code>decltype(è¡¨è¾¾å¼)</code> ï¼ˆè¡¨è¾¾å¼ä¸æ˜¯å˜é‡åï¼Œä½†åŒ…æ‹¬ <code>decltype((å˜é‡å))</code> çš„æƒ…å†µï¼‰å¯ä»¥è·å¾—è¡¨è¾¾å¼çš„å¼•ç”¨ç±»å‹ï¼›é™¤éè¡¨è¾¾å¼çš„ç»“æœæ˜¯ä¸ªçº¯å³å€¼ï¼ˆprvalueï¼‰ï¼Œæ­¤æ—¶ç»“æœä»ç„¶æ˜¯å€¼ç±»å‹ã€‚</li>
</ul><p>å¦‚æœæˆ‘ä»¬æœ‰ <code>int a;</code>ï¼Œé‚£ä¹ˆï¼š</p><ul>
<li><code>decltype(a)</code> ä¼šè·å¾— <code>int</code>ï¼ˆå› ä¸º <code>a</code> æ˜¯ <code>int</code>ï¼‰ã€‚</li>
<li><code>decltype((a))</code> ä¼šè·å¾— <code>int&amp;</code>ï¼ˆå› ä¸º <code>a</code> æ˜¯ lvalueï¼‰ã€‚</li>
<li><code>decltype(a + a)</code> ä¼šè·å¾— <code>int</code>ï¼ˆå› ä¸º <code>a + a</code> æ˜¯ prvalueï¼‰ã€‚</li>
</ul><h3>decltype(auto)</h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œèƒ½å†™ <code>auto</code> æ¥å£°æ˜å˜é‡è‚¯å®šæ˜¯ä»¶æ¯”è¾ƒè½»æ¾çš„äº‹ã€‚ä½†è¿™å„¿æœ‰ä¸ªé™åˆ¶ï¼Œä½ éœ€è¦åœ¨å†™ä¸‹ <code>auto</code> æ—¶å°±å†³å®šä½ å†™ä¸‹çš„æ˜¯ä¸ªå¼•ç”¨ç±»å‹è¿˜æ˜¯å€¼ç±»å‹ã€‚æ ¹æ®ç±»å‹æ¨å¯¼è§„åˆ™ï¼Œ<code>auto</code> æ˜¯å€¼ç±»å‹ï¼Œ<code>auto&amp;</code> æ˜¯å·¦å€¼å¼•ç”¨ç±»å‹ï¼Œ<code>auto&amp;&amp;</code> æ˜¯è½¬å‘å¼•ç”¨ï¼ˆå¯ä»¥æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å³å€¼å¼•ç”¨ï¼‰ã€‚ä½¿ç”¨ <code>auto</code> ä¸èƒ½é€šç”¨åœ°æ ¹æ®è¡¨è¾¾å¼ç±»å‹æ¥å†³å®šè¿”å›å€¼çš„ç±»å‹ã€‚ä¸è¿‡ï¼Œ<code>decltype(expr)</code> æ—¢å¯ä»¥æ˜¯å€¼ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre><code class="language-c++">decltype(expr) a = expr;
</code></pre><p>è¿™ç§å†™æ³•æ˜æ˜¾ä¸èƒ½è®©äººæ»¡æ„ï¼Œç‰¹åˆ«æ˜¯è¡¨è¾¾å¼å¾ˆé•¿çš„æƒ…å†µï¼ˆè€Œä¸”ï¼Œä»»ä½•ä»£ç é‡å¤éƒ½æ˜¯æ½œåœ¨çš„é—®é¢˜ï¼‰ã€‚ä¸ºæ­¤ï¼ŒC++14 å¼•å…¥äº† <code>decltype(auto)</code> è¯­æ³•ã€‚å¯¹äºä¸Šé¢çš„æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹é¢è¿™æ ·å†™å°±è¡Œäº†ã€‚</p><pre><code class="language-c++">decltype(auto) a = expr;
</code></pre><p>è¿™ç§ä»£ç ä¸»è¦ç”¨åœ¨é€šç”¨çš„è½¬å‘å‡½æ•°æ¨¡æ¿ä¸­ï¼šä½ å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“ä½ è°ƒç”¨çš„å‡½æ•°æ˜¯ä¸æ˜¯ä¼šè¿”å›ä¸€ä¸ªå¼•ç”¨ã€‚è¿™æ—¶ä½¿ç”¨è¿™ç§è¯­æ³•å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚</p><h3>å‡½æ•°è¿”å›å€¼ç±»å‹æ¨æ–­</h3><p>ä» C++14 å¼€å§‹ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿå¯ä»¥ç”¨ <code>auto</code> æˆ– <code>decltype(auto)</code> æ¥å£°æ˜äº†ã€‚åŒæ ·çš„ï¼Œç”¨ <code>auto</code> å¯ä»¥å¾—åˆ°å€¼ç±»å‹ï¼Œç”¨ <code>auto&amp;</code> æˆ– <code>auto&amp;&amp;</code> å¯ä»¥å¾—åˆ°å¼•ç”¨ç±»å‹ï¼›è€Œç”¨ <code>decltype(auto)</code> å¯ä»¥æ ¹æ®è¿”å›è¡¨è¾¾å¼é€šç”¨åœ°å†³å®šè¿”å›çš„æ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p>å’Œè¿™ä¸ªå½¢å¼ç›¸å…³çš„æœ‰å¦å¤–ä¸€ä¸ªè¯­æ³•ï¼Œåç½®è¿”å›å€¼ç±»å‹å£°æ˜ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ç®—â€œç±»å‹æ¨æ–­â€ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿæ”¾åœ¨ä¸€èµ·è®²å§ã€‚å®ƒçš„å½¢å¼æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><pre><code class="language-c++">auto foo(å‚æ•°) -&gt; è¿”å›å€¼ç±»å‹å£°æ˜
{
  // å‡½æ•°ä½“
}
</code></pre><p>é€šå¸¸ï¼Œåœ¨è¿”å›ç±»å‹æ¯”è¾ƒå¤æ‚ã€ç‰¹åˆ«æ˜¯è¿”å›ç±»å‹è·Ÿå‚æ•°ç±»å‹æœ‰æŸç§æ¨å¯¼å…³ç³»æ—¶ä¼šä½¿ç”¨è¿™ç§è¯­æ³•ã€‚ä»¥åæˆ‘ä»¬ä¼šè®²åˆ°ä¸€äº›å®ä¾‹ã€‚ä»Šå¤©æš‚æ—¶ä¸å¤šè®²äº†ã€‚</p><h3>ç±»æ¨¡æ¿çš„æ¨¡æ¿å‚æ•°æ¨å¯¼</h3><p>å¦‚æœä½ ç”¨è¿‡ <code>pair</code> çš„è¯ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šä½¿ç”¨ä¸‹é¢è¿™ç§å½¢å¼ï¼š</p><pre><code class="language-c++">pair&lt;int, int&gt; pr{1, 42};
</code></pre><p>ä½¿ç”¨ <code>make_pair</code> æ˜¾ç„¶æ›´å®¹æ˜“ä¸€äº›ï¼š</p><pre><code class="language-c++">auto pr = make_pair(1, 42);
</code></pre><p>è¿™æ˜¯å› ä¸ºå‡½æ•°æ¨¡æ¿æœ‰æ¨¡æ¿å‚æ•°æ¨å¯¼ï¼Œä½¿å¾—è°ƒç”¨è€…ä¸å¿…æ‰‹å·¥æŒ‡å®šå‚æ•°ç±»å‹ï¼›ä½† C++17 ä¹‹å‰çš„ç±»æ¨¡æ¿å´æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå› è€Œå‚¬ç”Ÿäº†åƒ <code>make_pair</code> è¿™æ ·çš„å·¥å…·å‡½æ•°ã€‚</p><p>åœ¨è¿›å…¥äº† C++17 çš„ä¸–ç•Œåï¼Œè¿™ç±»å‡½æ•°å˜å¾—ä¸å¿…è¦äº†ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ï¼š</p><pre><code class="language-c++">pair pr{1, 42};
</code></pre><p>ç”Ÿæ´»ä¸€ä¸‹å­å˜å¾—ç®€å•å¤šäº†ï¼</p><p>åœ¨åˆæ¬¡è§åˆ° <code>array</code> æ—¶ï¼Œæˆ‘è§‰å¾—å®ƒçš„ä¸»è¦ç¼ºç‚¹å°±æ˜¯ä¸èƒ½åƒ C æ•°ç»„ä¸€æ ·è‡ªåŠ¨ä»åˆå§‹åŒ–åˆ—è¡¨æ¥æ¨æ–­æ•°ç»„çš„å¤§å°äº†ï¼š</p><pre><code class="language-c++">int a1[] = {1, 2, 3};
array&lt;int, 3&gt; a2{1, 2, 3}; // å•°å—¦
// array&lt;int&gt; a3{1, 2, 3}; ä¸è¡Œ
</code></pre><p>è¿™ä¸ªé—®é¢˜åœ¨ C++17 é‡Œä¹Ÿæ˜¯åŸºæœ¬ä¸å­˜åœ¨çš„ã€‚è™½ç„¶ä¸èƒ½åªæä¾›ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œä½†ä½ å¯ä»¥ä¸¤ä¸ªå‚æ•°å…¨éƒ½ä¸å†™ ğŸ¤£ï¼š</p><pre><code class="language-c++">array a{1, 2, 3};
// å¾—åˆ° array&lt;int, 3&gt;
</code></pre><p>è¿™ç§è‡ªåŠ¨æ¨å¯¼æœºåˆ¶ï¼Œå¯ä»¥æ˜¯ç¼–è¯‘å™¨æ ¹æ®æ„é€ å‡½æ•°æ¥è‡ªåŠ¨ç”Ÿæˆï¼š</p><pre><code class="language-c++">template &lt;typename T&gt;
struct MyObj {
  MyObj(T value);
  â€¦
};

MyObj obj1{string("hello")};
// å¾—åˆ° MyObj&lt;string&gt;
MyObj obj2{"hello"};
// å¾—åˆ° MyObj&lt;const char*&gt;
</code></pre><p>ä¹Ÿå¯ä»¥æ˜¯æ‰‹å·¥æä¾›ä¸€ä¸ªæ¨å¯¼å‘å¯¼ï¼Œè¾¾åˆ°è‡ªå·±éœ€è¦çš„æ•ˆæœï¼š</p><pre><code class="language-c++">template &lt;typename T&gt;
struct MyObj {
  MyObj(T value);
  â€¦
};

MyObj(const char*) -&gt; MyObj&lt;string&gt;;

MyObj obj{"hello"};
// å¾—åˆ° MyObj&lt;string&gt;
</code></pre><p>æ›´å¤šçš„æŠ€æœ¯ç»†èŠ‚è¯·å‚è§å‚è€ƒèµ„æ–™ <span class="orange">[4]</span>ã€‚</p><h3>ç»“æ„åŒ–ç»‘å®š</h3><p>åœ¨è®²å…³è”å®¹å™¨çš„æ—¶å€™æˆ‘ä»¬æœ‰è¿‡è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class="language-c++">multimap&lt;string, int&gt;::iterator
  lower, upper;
std::tie(lower, upper) =
  mmp.equal_range("four");
</code></pre><p>è¿™ä¸ªä¾‹å­é‡Œï¼Œè¿”å›å€¼æ˜¯ä¸ª <code>pair</code>ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨ä¸¤ä¸ªå˜é‡æ¥æ¥æ”¶æ•°å€¼ï¼Œå°±ä¸å¾—ä¸å£°æ˜äº†ä¸¤ä¸ªå˜é‡ï¼Œç„¶åä½¿ç”¨ <code>tie</code> æ¥æ¥æ”¶ç»“æœã€‚åœ¨ C++11/14 é‡Œï¼Œè¿™é‡Œæ˜¯æ²¡æ³•ä½¿ç”¨ <code>auto</code> çš„ã€‚å¥½åœ¨ C++17 å¼•å…¥äº†ä¸€ä¸ªæ–°è¯­æ³•ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç ç®€åŒ–ä¸ºï¼š</p><pre><code class="language-c++">auto [lower, upper] =
  mmp.equal_range("four");
</code></pre><p>è¿™ä¸ªè¯­æ³•ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨ <code>auto</code> å£°æ˜å˜é‡æ¥åˆ†åˆ«è·å– <code>pair</code> æˆ– <code>tuple</code> è¿”å›å€¼é‡Œå„ä¸ªå­é¡¹ï¼Œå¯ä»¥è®©ä»£ç çš„å¯è¯»æ€§æ›´å¥½ã€‚</p><p>å…³äºè¿™ä¸ªè¯­æ³•çš„æ›´å¤šæŠ€æœ¯è¯´æ˜ï¼Œè¯·å‚è§å‚è€ƒèµ„æ–™ <span class="orange">[5]</span>ã€‚</p><h2>åˆ—è¡¨åˆå§‹åŒ–</h2><p>åœ¨ C++98 é‡Œï¼Œæ ‡å‡†å®¹å™¨æ¯”èµ· C é£æ ¼æ•°ç»„è‡³å°‘æœ‰ä¸€ä¸ªæ˜æ˜¾çš„åŠ£åŠ¿ï¼šä¸èƒ½åœ¨ä»£ç é‡Œæ–¹ä¾¿åœ°åˆå§‹åŒ–å®¹å™¨çš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œå¯¹äºæ•°ç»„ä½ å¯ä»¥å†™ï¼š</p><pre><code class="language-c++">int a[] = {1, 2, 3, 4, 5};
</code></pre><p>è€Œå¯¹äº <code>vector</code> ä½ å´å¾—å†™ï¼š</p><pre><code class="language-c++">vector&lt;int&gt; v;
v.push(1);
v.push(2);
v.push(3);
v.push(4);
v.push(5);
</code></pre><p>è¿™æ ·çœŸæ˜¯åˆå•°å—¦ï¼Œæ€§èƒ½åˆå·®ï¼Œæ˜¾ç„¶æ— æ³•è®©äººæ»¡æ„ã€‚äºæ˜¯ï¼ŒC++ æ ‡å‡†å§”å‘˜ä¼šå¼•å…¥äº†åˆ—è¡¨åˆå§‹åŒ–ï¼Œå…è®¸ä»¥æ›´ç®€å•çš„æ–¹å¼æ¥åˆå§‹åŒ–å¯¹è±¡ã€‚ç°åœ¨æˆ‘ä»¬åˆå§‹åŒ–å®¹å™¨ä¹Ÿå¯ä»¥å’Œåˆå§‹åŒ–æ•°ç»„ä¸€æ ·ç®€å•äº†ï¼š</p><pre><code class="language-c++">vector&lt;int&gt; v{1, 2, 3, 4, 5};
</code></pre><p>åŒæ ·é‡è¦çš„æ˜¯ï¼Œè¿™ä¸æ˜¯å¯¹æ ‡å‡†åº“å®¹å™¨çš„ç‰¹æ®Šé­”æ³•ï¼Œè€Œæ˜¯ä¸€ä¸ªé€šç”¨çš„ã€å¯ä»¥ç”¨äºå„ç§ç±»çš„æ–¹æ³•ã€‚ä»æŠ€æœ¯è§’åº¦ï¼Œç¼–è¯‘å™¨çš„é­”æ³•åªæ˜¯å¯¹ <code>{1, 2, 3}</code> è¿™æ ·çš„è¡¨è¾¾å¼è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåˆå§‹åŒ–åˆ—è¡¨ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œå…¶ç±»å‹æ˜¯ <code>initializer_list&lt;int&gt;</code>ã€‚ç¨‹åºå‘˜åªéœ€è¦å£°æ˜ä¸€ä¸ªæ¥å— <code>initializer_list</code> çš„æ„é€ å‡½æ•°å³å¯ä½¿ç”¨ã€‚ä»æ•ˆç‡çš„è§’åº¦ï¼Œè‡³å°‘åœ¨åŠ¨æ€å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå®¹å™¨å’Œæ•°ç»„ä¹Ÿå¹¶æ— äºŒè‡´ï¼Œéƒ½æ˜¯é€šè¿‡æ‹·è´ï¼ˆæ„é€ ï¼‰è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>å¯¹äºåˆå§‹åŒ–åˆ—è¡¨åœ¨æ„é€ å‡½æ•°å¤–çš„ç”¨æ³•å’Œæ›´å¤šçš„æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·å‚è§å‚è€ƒèµ„æ–™ <span class="orange">[6]</span>ã€‚</p><h2>ç»Ÿä¸€åˆå§‹åŒ–</h2><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œæˆ‘åœ¨ä»£ç é‡Œä½¿ç”¨äº†å¤§æ‹¬å· <code>{}</code> æ¥è¿›è¡Œå¯¹è±¡çš„åˆå§‹åŒ–ã€‚è¿™å½“ç„¶ä¹Ÿæ˜¯ C++11 å¼•å…¥çš„æ–°è¯­æ³•ï¼Œèƒ½å¤Ÿä»£æ›¿å¾ˆå¤šå°æ‹¬å· <code>()</code> åœ¨å˜é‡åˆå§‹åŒ–æ—¶ä½¿ç”¨ã€‚è¿™è¢«ç§°ä¸ºç»Ÿä¸€åˆå§‹åŒ–ï¼ˆuniform initializationï¼‰ã€‚</p><p>å¤§æ‹¬å·å¯¹äºæ„é€ ä¸€ä¸ªå¯¹è±¡è€Œè¨€ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯é¿å…äº† C++ é‡Œâ€œæœ€ä»¤äººæ¼ç«çš„è¯­æ³•åˆ†æâ€ï¼ˆthe most vexing parseï¼‰ã€‚æˆ‘ä¹Ÿé‡åˆ°è¿‡ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªç±»ï¼ŒåŸå‹å¦‚ä¸‹ï¼š</p><pre><code class="language-c++">class utf8_to_wstring {
public:
  utf8_to_wstring(const char*);
  operator wchar_t*();
};
</code></pre><p>ç„¶åä½ åœ¨ Windows ä¸‹æƒ³ä½¿ç”¨è¿™ä¸ªç±»æ¥å¸®åŠ©è½¬æ¢æ–‡ä»¶åï¼Œæ‰“å¼€æ–‡ä»¶ï¼š</p><pre><code class="language-c++">ifstream ifs(
  utf8_to_wstring(filename));
</code></pre><p>ä½ éšåå°±ä¼šå‘ç°ï¼Œ<code>ifs</code> çš„è¡Œä¸ºæ— è®ºå¦‚ä½•éƒ½ä¸æ­£å¸¸ã€‚æœ€åï¼Œè¦ä¹ˆä½ è‡ªå·±æŸ¥åˆ°ï¼Œè¦ä¹ˆæœ‰äººå‘Šè¯‰ä½ ï¼Œä¸Šé¢è¿™ä¸ªå†™æ³•ä¼šè¢«ç¼–è¯‘å™¨è®¤ä¸ºæ˜¯å’Œä¸‹é¢çš„å†™æ³•ç­‰ä»·çš„ï¼š</p><pre><code class="language-c++">ifstream ifs(
  utf8_to_wstring filename);
</code></pre><p>æ¢å¥è¯è¯´ï¼Œç¼–è¯‘å™¨è®¤ä¸ºä½ æ˜¯å£°æ˜äº†ä¸€ä¸ªå« <code>ifs</code> çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¯¹è±¡ï¼</p><p>å¦‚æœä½ æŠŠä»»ä½•ä¸€å¯¹å°æ‹¬å·æ›¿æ¢æˆå¤§æ‹¬å·ï¼ˆæˆ–è€…éƒ½æ›¿æ¢ï¼Œå¦‚ä¸‹ï¼‰ï¼Œåˆ™å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜ï¼š</p><pre><code class="language-c++">ifstream ifs{
  utf8_to_wstring{filename}};
</code></pre><p>æ¨è€Œå¹¿ä¹‹ï¼Œä½ å‡ ä¹å¯ä»¥åœ¨æ‰€æœ‰åˆå§‹åŒ–å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨å¤§æ‹¬å·è€Œä¸æ˜¯å°æ‹¬å·ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªé™„å¸¦çš„ç‰¹ç‚¹ï¼šå½“ä¸€ä¸ªæ„é€ å‡½æ•°æ²¡æœ‰æ ‡æˆ <code>explicit</code> æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·ä¸å†™ç±»åæ¥è¿›è¡Œæ„é€ ï¼Œå¦‚æœè°ƒç”¨ä¸Šä¸‹æ–‡è¦æ±‚é‚£ç±»å¯¹è±¡çš„è¯ã€‚å¦‚ï¼š</p><pre><code class="language-c++">Obj getObj()
{
  return {1.0};
}
</code></pre><p>å¦‚æœ Obj ç±»å¯ä»¥ä½¿ç”¨æµ®ç‚¹æ•°è¿›è¡Œæ„é€ çš„è¯ï¼Œä¸Šé¢çš„å†™æ³•å°±æ˜¯åˆæ³•çš„ã€‚å¦‚æœæœ‰æ— å‚æ•°ã€å¤šå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå½¢å¼ã€‚é™¤äº†å½¢å¼ä¸Šçš„åŒºåˆ«ï¼Œå®ƒè·Ÿ <code>Obj(1.0)</code> çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œåè€…å¯ä»¥ç”¨æ¥è°ƒç”¨ <code>Obj(int)</code>ï¼Œè€Œä½¿ç”¨å¤§æ‹¬å·æ—¶ç¼–è¯‘å™¨ä¼šæ‹’ç»â€œçª„â€è½¬æ¢ï¼Œä¸æ¥å—ä»¥ <code>{1.0}</code> æˆ– <code>Obj{1.0}</code> çš„å½¢å¼è°ƒç”¨æ„é€ å‡½æ•° <code>Obj(int)</code>ã€‚</p><p>è¿™ä¸ªè¯­æ³•ä¸»è¦çš„é™åˆ¶æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ„é€ å‡½æ•°æ—¢æœ‰ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°ï¼Œåˆæœ‰ä¸ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°ï¼Œé‚£ç¼–è¯‘å™¨ä¼š<strong>åƒæ–¹ç™¾è®¡</strong>åœ°è¯•å›¾è°ƒç”¨ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°ï¼Œå¯¼è‡´å„ç§æ„å¤–ã€‚æ‰€ä»¥ï¼Œå¦‚æœç»™ä¸€ä¸ªæ¨èçš„è¯ï¼Œé‚£å°±æ˜¯ï¼š</p><ul>
<li>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°æ—¶ï¼Œåˆå§‹åŒ–è¯¥ç±»å¯¹è±¡å¯å…¨éƒ¨ä½¿ç”¨ç»Ÿä¸€åˆå§‹åŒ–è¯­æ³•ã€‚</li>
<li>å¦‚æœä¸€ä¸ªç±»æœ‰ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°æ—¶ï¼Œåˆ™åªåº”ç”¨åœ¨åˆå§‹åŒ–åˆ—è¡¨æ„é€ çš„æƒ…å†µã€‚</li>
</ul><p>å…³äºè¿™ä¸ªè¯­æ³•çš„æ›´å¤šè¯¦ç»†ç”¨æ³•è®¨è®ºï¼Œè¯·å‚è§å‚è€ƒèµ„æ–™ <span class="orange">[7]</span>ã€‚</p><h2>ç±»æ•°æ®æˆå‘˜çš„é»˜è®¤åˆå§‹åŒ–</h2><p>æŒ‰ç…§ C++98 çš„è¯­æ³•ï¼Œæ•°æ®æˆå‘˜å¯ä»¥åœ¨æ„é€ å‡½æ•°é‡Œè¿›è¡Œåˆå§‹åŒ–ã€‚è¿™æœ¬èº«ä¸æ˜¯é—®é¢˜ï¼Œä½†å®è·µä¸­ï¼Œå¦‚æœæ•°æ®æˆå‘˜æ¯”è¾ƒå¤šã€æ„é€ å‡½æ•°åˆæœ‰å¤šä¸ªçš„è¯ï¼Œé€ä¸ªå»åˆå§‹åŒ–æ˜¯ä¸ªç´¯èµ˜ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“åœ¨å¢åŠ æ•°æ®æˆå‘˜æ—¶æ¼æ‰åœ¨æŸä¸ªæ„é€ å‡½æ•°ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚ä¸ºæ­¤ï¼ŒC++11 å¢åŠ äº†ä¸€ä¸ªè¯­æ³•ï¼Œå…è®¸åœ¨å£°æ˜æ•°æ®æˆå‘˜æ—¶ç›´æ¥ç»™äºˆä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ã€‚è¿™æ ·ï¼Œå½“ä¸”ä»…å½“æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­ä¸åŒ…å«è¯¥æ•°æ®æˆå‘˜æ—¶ï¼Œè¿™ä¸ªæ•°æ®æˆå‘˜å°±ä¼šè‡ªåŠ¨ä½¿ç”¨åˆå§‹åŒ–è¡¨è¾¾å¼è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>è¿™ä¸ªå¥å­æœ‰ç‚¹é•¿ã€‚æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼š</p><pre><code class="language-c++">class Complex {
public:
  Complex()
    : re_(0) , im_(0) {}
  Complex(float re)
    : re_(re), im_(0) {}
  Complex(float re, float im)
    : re_(re) , im_(im) {}
  â€¦

private:
  float re_;
  float im_;
};
</code></pre><p>å‡è®¾ç”±äºæŸç§åŸå› ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç¼ºçœå‚æ•°æ¥ç®€åŒ–æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»€ä¹ˆæ–¹å¼æ¥ä¼˜åŒ–ä¸Šé¢è¿™ä¸ªä»£ç å‘¢ï¼Ÿ</p><p>ä½¿ç”¨æ•°æ®æˆå‘˜çš„é»˜è®¤åˆå§‹åŒ–çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre><code class="language-c++">class Complex {
public:
  Complex() {}
  Complex(float re) : re_(re) {}
  Complex(float re, float im)
    : re_(re) , im_(im) {}

private:
  float re_{0};
  float im_{0};
};
</code></pre><p>ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°æ²¡æœ‰ä»»ä½•åˆå§‹åŒ–åˆ—è¡¨ï¼Œæ‰€ä»¥ç±»æ•°æ®æˆå‘˜çš„åˆå§‹åŒ–å…¨éƒ¨ç”±é»˜è®¤åˆå§‹åŒ–å®Œæˆï¼Œ<code>re_</code> å’Œ <code>im_</code> éƒ½æ˜¯ 0ã€‚ç¬¬äºŒä¸ªæ„é€ å‡½æ•°æä¾›äº† <code>re_</code> çš„åˆå§‹åŒ–ï¼Œ<code>im_</code> ä»ç”±é»˜è®¤åˆå§‹åŒ–å®Œæˆã€‚ç¬¬ä¸‰ä¸ªæ„é€ å‡½æ•°åˆ™å®Œå…¨ä¸ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>åœ¨æœ¬è®²ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ç°ä»£ C++ å¼•å…¥çš„å‡ ä¸ªæ˜“ç”¨æ€§æ”¹è¿›ï¼šè‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œåˆå§‹åŒ–åˆ—è¡¨ï¼ŒåŠç±»æ•°æ®æˆå‘˜çš„é»˜è®¤åˆå§‹åŒ–ã€‚ä½¿ç”¨è¿™äº›ç‰¹æ€§éå¸¸ç®€å•ï¼Œå¯ä»¥ç«‹å³ç®€åŒ–ä½ çš„ C++ ä»£ç ï¼Œè€Œä¸ä¼šå¼•å…¥é¢å¤–çš„å¼€é”€ã€‚å”¯ä¸€çš„è¦æ±‚åªæ˜¯ä½ ä¸è¦å†ä½¿ç”¨é‚£äº›ä¸Šå¤æ—¶ä»£çš„è€æ‰ç‰™ç¼–è¯‘å™¨äº†â€¦â€¦</p><h2>è¯¾åæ€è€ƒ</h2><p>ä½ ä½¿ç”¨è¿‡ç°ä»£ C++ çš„è¿™äº›ç‰¹æ€§äº†å—ï¼Ÿå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼Œå“ªäº›ç‰¹æ€§ä½ æ‰“ç®—åœ¨ä¸‹ä¸€ä¸ªé¡¹ç›®é‡Œå¼€å§‹ä½¿ç”¨ï¼Ÿ</p><p>æ¬¢è¿ç•™è¨€æ¥åˆ†äº«ä½ çš„çœ‹æ³•ã€‚</p><h2><span class="reference">å‚è€ƒèµ„æ–™</span></h2><p><span class="reference">[1] cppreference.com, â€œPlaceholder type specifiersâ€. <a href="https://en.cppreference.com/w/cpp/language/auto">https://en.cppreference.com/w/cpp/language/auto</a> </span></p><p><span class="reference">[1a] cppreference.com, â€œå ä½ç¬¦ç±»å‹è¯´æ˜ç¬¦â€. <a href="https://zh.cppreference.com/w/cpp/language/auto">https://zh.cppreference.com/w/cpp/language/auto</a> </span></p><p><span class="reference">[2] Wikipedia, â€œArgument-dependent name lookupâ€. <a href="https://en.wikipedia.org/wiki/Argument-dependent_name_lookup">https://en.wikipedia.org/wiki/Argument-dependent_name_lookup</a> </span></p><p><span class="reference">[2a] ç»´åŸºç™¾ç§‘, â€œä¾èµ–äºå®å‚çš„åå­—æŸ¥æ‰¾â€. <a href="https://zh.wikipedia.org/zh-cn/%E4%BE%9D%E8%B5%96%E4%BA%8E%E5%AE%9E%E5%8F%82%E7%9A%84%E5%90%8D%E5%AD%97%E6%9F%A5%E6%89%BE">https://zh.wikipedia.org/zh-cn/ä¾èµ–äºå®å‚çš„åå­—æŸ¥æ‰¾</a> </span></p><p><span class="reference">[3] cppreference.com, â€œTemplate argument deductionâ€. <a href="https://en.cppreference.com/w/cpp/language/template_argument_deduction">https://en.cppreference.com/w/cpp/language/template_argument_deduction</a> </span></p><p><span class="reference">[3a] cppreference.com, â€œæ¨¡æ¿å®å‚æ¨å¯¼â€. <a href="https://zh.cppreference.com/w/cpp/language/template_argument_deduction">https://zh.cppreference.com/w/cpp/language/template_argument_deduction</a> </span></p><p><span class="reference">[4] cppreference.com, â€œClass template argument deductionâ€. <a href="https://en.cppreference.com/w/cpp/language/class_template_argument_deduction">https://en.cppreference.com/w/cpp/language/class_template_argument_deduction</a> </span></p><p><span class="reference">[4a] cppreference.com, â€œç±»æ¨¡æ¿å®å‚æ¨å¯¼â€. <a href="https://zh.cppreference.com/w/cpp/language/class_template_argument_deduction">https://zh.cppreference.com/w/cpp/language/class_template_argument_deduction</a> </span></p><p><span class="reference">[5] cppreference.com, â€œStructured binding declarationâ€. <a href="https://en.cppreference.com/w/cpp/language/structured_binding">https://en.cppreference.com/w/cpp/language/structured_binding</a> </span></p><p><span class="reference">[5a] cppreference.com, â€œç»“æ„åŒ–ç»‘å®šå£°æ˜â€. <a href="https://zh.cppreference.com/w/cpp/language/structured_binding">https://zh.cppreference.com/w/cpp/language/structured_binding</a> </span></p><p><span class="reference">[6] cppreference.com, â€œstd::initializer_listâ€. <a href="https://en.cppreference.com/w/cpp/utility/initializer_list">https://en.cppreference.com/w/cpp/utility/initializer_list</a> </span></p><p><span class="reference">[6a] cppreference.com, â€œstd::initializer_listâ€. <a href="https://en.cppreference.com/w/cpp/utility/initializer_list">https://en.cppreference.com/w/cpp/utility/initializer_list</a> </span></p><p><span class="reference">[7] Scott Meyers, <em>Effective Modern C++</em>, item 7. Oâ€™Reilly Media, 2014. æœ‰ä¸­æ–‡ç‰ˆï¼ˆé«˜åšè¯‘ï¼Œä¸­å›½ç”µåŠ›å‡ºç‰ˆç¤¾ï¼Œ2018 å¹´ï¼‰</span></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;            line-height:1.2">
            Geek_94a091  2019-12-13 00:36:36
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;            word-break:break-all;line-height:1.6">
            æƒ³çŸ¥é“autoåˆ°åº•ä»€ä¹ˆæƒ…å†µä¸‹ç”¨ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¸è¦ç”¨autoï¼Œç”¨å¤šäº†ä¼šä¸ä¼šé€ æˆé˜…è¯»å›°éš¾ 
        </div>
        
    </div>
</li>
            </ul>
</div>
</body>
</html>